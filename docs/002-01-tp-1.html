<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-27T21:24:56.999911"><title>TP 1 : Mettre notre service en bo&icirc;te : la Dockerisation | Spring Micro Services</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs Pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction-le-syndrome-du-a-marche-sur-ma-machine","level":0,"title":"Introduction : Le syndrome du \"ça marche sur ma machine\"","anchor":"#introduction-le-syndrome-du-a-marche-sur-ma-machine"},{"id":"qu-est-ce-qu-un-dockerfile","level":0,"title":"Qu\u0027est-ce qu\u0027un Dockerfile ?","anchor":"#qu-est-ce-qu-un-dockerfile"},{"id":"tp-dockerisation-de-product-service","level":0,"title":"TP : Dockerisation de product-service","anchor":"#tp-dockerisation-de-product-service"},{"id":"exercice-4-configurer-le-conteneur-au-lancement","level":0,"title":"Exercice 4 : Configurer le conteneur au lancement","anchor":"#exercice-4-configurer-le-conteneur-au-lancement"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"conclusion","level":0,"title":"Conclusion","anchor":"#conclusion"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="TP 1 : Mettre notre service en bo&icirc;te : la Dockerisation | Spring Micro Services"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Spring Micro Services Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/002-01-tp-1.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="TP 1 : Mettre notre service en bo&icirc;te : la Dockerisation | Spring Micro Services"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/002-01-tp-1.html#webpage",
    "url": "writerside-documentation/002-01-tp-1.html",
    "name": "TP 1 : Mettre notre service en bo&icirc;te : la Dockerisation | Spring Micro Services",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Spring Micro Services Help"
}</script><!-- End Schema.org --></head><body data-id="002-01-tp-1" data-main-title="TP 1 : Mettre notre service en boîte : la Dockerisation" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="002-00-first-micro-service.md|Module 2 : Cas d'étude et Premier Microservice"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Spring Micro Services  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="002-01-tp-1" id="002-01-tp-1.md">TP 1 : Mettre notre service en boîte : la Dockerisation</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs P&eacute;dagogiques</h2><p id="-1w6eyk_10">&Agrave; la fin de ce TP, vous serez capable de :</p><ul class="list _bullet" id="-1w6eyk_11"><li class="list__item" id="-1w6eyk_12"><p id="-1w6eyk_16">Expliquer l'utilit&eacute; de Docker pour un d&eacute;veloppeur.</p></li><li class="list__item" id="-1w6eyk_13"><p id="-1w6eyk_17">&Eacute;crire un <code class="code" id="-1w6eyk_18">Dockerfile</code> optimis&eacute; en plusieurs &eacute;tapes (multi-stage build).</p></li><li class="list__item" id="-1w6eyk_14"><p id="-1w6eyk_19">Construire une image Docker pour une application Spring Boot.</p></li><li class="list__item" id="-1w6eyk_15"><p id="-1w6eyk_20">Lancer un conteneur Docker et interagir avec l'application qu'il h&eacute;berge.</p></li></ul></section><section class="chapter"><h2 id="introduction-le-syndrome-du-a-marche-sur-ma-machine" data-toc="introduction-le-syndrome-du-a-marche-sur-ma-machine">Introduction : Le syndrome du &quot;&ccedil;a marche sur ma machine&quot;</h2><p id="-1w6eyk_21">Vous avez tous v&eacute;cu ou vivrez cette situation : vous terminez une fonctionnalit&eacute;, tout fonctionne parfaitement sur votre poste. Vous la livrez, et l&agrave;, c'est le drame. Votre coll&egrave;gue vous dit &quot;&ccedil;a ne marche pas chez moi&quot; ou, pire, &ccedil;a ne fonctionne pas sur le serveur de production. Les raisons peuvent &ecirc;tre multiples : une version diff&eacute;rente de Java, une variable d'environnement manquante, une configuration syst&egrave;me sp&eacute;cifique... C'est un cauchemar &agrave; d&eacute;boguer.</p><p id="-1w6eyk_22">Docker r&eacute;sout ce probl&egrave;me. Imaginez un conteneur de transport maritime. Peu importe ce qu'il y a dedans (des voitures, des bananes, des ordinateurs), il se manipule toujours de la m&ecirc;me fa&ccedil;on. Docker fait la m&ecirc;me chose pour nos applications. On &quot;embo&icirc;te&quot; notre application et toutes ses d&eacute;pendances (la bonne version de Java, les bons fichiers, etc.) dans une <span class="control" id="-1w6eyk_24">image</span>. Cette image peut ensuite &ecirc;tre ex&eacute;cut&eacute;e de mani&egrave;re identique sur n'importe quelle machine disposant de Docker, cr&eacute;ant ainsi un <span class="control" id="-1w6eyk_25">conteneur</span>.</p><p id="-1w6eyk_23">Aujourd'hui, nous allons cr&eacute;er le &quot;conteneur maritime&quot; pour notre <code class="code" id="-1w6eyk_26">product-service</code>, pour qu'il puisse voyager et s'ex&eacute;cuter n'importe o&ugrave;, de mani&egrave;re fiable et pr&eacute;dictible.</p></section><section class="chapter"><h2 id="qu-est-ce-qu-un-dockerfile" data-toc="qu-est-ce-qu-un-dockerfile">Qu'est-ce qu'un Dockerfile ?</h2><p id="-1w6eyk_27">Un <code class="code" id="-1w6eyk_30">Dockerfile</code> est tout simplement un fichier texte qui contient la &quot;recette&quot; pour construire une image Docker. C'est une liste d'instructions, &eacute;tape par &eacute;tape.</p><section class="chapter"><h3 id="l-approche-na-ve-ne-pas-faire-en-production" data-toc="l-approche-na-ve-ne-pas-faire-en-production">L'approche na&iuml;ve (&agrave; ne pas faire en production)</h3><p id="-1w6eyk_31">On pourrait cr&eacute;er un <code class="code" id="-1w6eyk_34">Dockerfile</code> tr&egrave;s simple :</p><ol class="list _decimal" id="-1w6eyk_32" type="1"><li class="list__item" id="-1w6eyk_35"><p id="-1w6eyk_39">Prendre une image Java avec Maven.</p></li><li class="list__item" id="-1w6eyk_36"><p id="-1w6eyk_40">Copier tout notre code source.</p></li><li class="list__item" id="-1w6eyk_37"><p id="-1w6eyk_41">Lancer la compilation avec Maven.</p></li><li class="list__item" id="-1w6eyk_38"><p id="-1w6eyk_42">Lancer le <code class="code" id="-1w6eyk_43">.jar</code> g&eacute;n&eacute;r&eacute;.</p></li></ol><p id="-1w6eyk_33">Le probl&egrave;me ? L'image finale contiendrait tout le code source, Maven, et le JDK complet. C'est une image &eacute;norme (plusieurs centaines de Mo) et peu s&eacute;curis&eacute;e (elle embarque des outils de build inutiles en production).</p></section><section class="chapter"><h3 id="l-approche-optimis-e-le-multi-stage-build" data-toc="l-approche-optimis-e-le-multi-stage-build">L'approche optimis&eacute;e : Le Multi-Stage Build</h3><p id="-1w6eyk_44">C'est la bonne pratique que nous allons utiliser. L'id&eacute;e est d'utiliser plusieurs &quot;&eacute;tapes&quot; (stages) dans notre <code class="code" id="-1w6eyk_48">Dockerfile</code>.</p><ul class="list _bullet" id="-1w6eyk_45"><li class="list__item" id="-1w6eyk_49"><p id="-1w6eyk_51"><span class="control" id="-1w6eyk_53">&Eacute;tape 1 : Le &quot;Build Stage&quot;</span></p><ul class="list _bullet" id="-1w6eyk_52"><li class="list__item" id="-1w6eyk_54"><p id="-1w6eyk_56">On utilise une image compl&egrave;te (avec JDK et Maven) pour compiler notre code et cr&eacute;er le fichier <code class="code" id="-1w6eyk_57">.jar</code>.</p></li><li class="list__item" id="-1w6eyk_55"><p id="-1w6eyk_58">Cette &eacute;tape est temporaire.</p></li></ul></li><li class="list__item" id="-1w6eyk_50"><p id="-1w6eyk_59"><span class="control" id="-1w6eyk_61">&Eacute;tape 2 : Le &quot;Runtime Stage&quot;</span></p><ul class="list _bullet" id="-1w6eyk_60"><li class="list__item" id="-1w6eyk_62"><p id="-1w6eyk_64">On part d'une image de base beaucoup plus l&eacute;g&egrave;re, qui contient uniquement l'environnement d'ex&eacute;cution Java (JRE).</p></li><li class="list__item" id="-1w6eyk_63"><p id="-1w6eyk_65">On copie <span class="control" id="-1w6eyk_66">uniquement</span> le fichier <code class="code" id="-1w6eyk_67">.jar</code> g&eacute;n&eacute;r&eacute; &agrave; l'&eacute;tape 1 dans cette nouvelle image.</p></li></ul></li></ul><p id="-1w6eyk_46">Le r&eacute;sultat ? Une image finale l&eacute;g&egrave;re, optimis&eacute;e et s&eacute;curis&eacute;e, qui ne contient que le strict n&eacute;cessaire pour ex&eacute;cuter notre application.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="622px" preserveAspectRatio="none" style="width:498px;height:622px;background:#FFFFFF;" version="1.1" viewBox="0 0 498 622" width="498px" zoomAndPan="magnify"><defs/><g><!--cluster Dockerfile Multi-Stage--><g id="cluster_Dockerfile Multi-Stage"><path d="M13.5,11 L189.5,11 A3.75,3.75 0 0 1 192,13.5 L199,34.0146 L461.5,34.0146 A2.5,2.5 0 0 1 464,36.5146 L464,612.56 A2.5,2.5 0 0 1 461.5,615.06 L13.5,615.06 A2.5,2.5 0 0 1 11,612.56 L11,13.5 A2.5,2.5 0 0 1 13.5,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="11" x2="199" y1="34.0146" y2="34.0146"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="175" x="15" y="27.0752">Dockerfile Multi-Stage</text></g><!--cluster BuildStage--><g id="cluster_BuildStage"><rect fill="#FFFFFF" height="352.05" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="373" x="51" y="55"/><path d="M177,55 L177,65.0146 L167,75.0146 L51,75.0146 " fill="none" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="116" x="54" y="70.0752">Stage 1 : Build</text></g><!--cluster BaseBuild--><g id="cluster_BaseBuild"><polygon fill="#FFFFFF" points="75,109,85,99,400,99,400,186.02,390,196.02,75,196.02,75,109" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="390" x2="400" y1="109" y2="99"/><line style="stroke:#000000;stroke-width:1.0;" x1="75" x2="390" y1="109" y2="109"/><line style="stroke:#000000;stroke-width:1.0;" x1="390" x2="390" y1="109" y2="196.02"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="159" x="154" y="126.0752">Image JDK + Maven</text></g><!--cluster ProdStage--><g id="cluster_ProdStage"><rect fill="#FFFFFF" height="99.01" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="405" x="35" y="492.05"/><path d="M206,492.05 L206,502.0646 L196,512.0646 L35,512.0646 " fill="none" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="161" x="38" y="507.1252">Stage 2 : Production</text></g><!--entity MvnCmd--><g id="elem_MvnCmd"><path d="M150.5451,251.6378 C153.81,245.4438 159.2616,245.8132 163.3359,250.7038 C166.8938,243.7746 171.7233,243.3145 176.1339,249.8961 C179.2541,242.8084 185.1335,242.3215 189.5524,248.5916 C192.7425,242.4086 199.4526,240.2371 203.914,247.203 C208.055,240.5328 212.8814,240.3046 216.7827,247.4267 C221.2114,241.7855 226.7867,242.7907 229.3255,249.3669 C234.6525,243.5321 238.944,245.2571 242.3138,251.4759 C247.7126,245.2937 252.8965,244.2238 257.2882,252.5177 C265.3213,255.4261 268.0827,259.376 262.0074,266.9104 C266.4721,274.5929 265.884,279.9754 256.3061,282.5332 C252.2909,289.3889 248.1046,289.3236 242.941,283.77 C240.2096,290.5755 235.6932,292.0479 230.5943,286.0539 C227.9564,292.252 222.1,294.5764 217.4459,288.1545 C214.3607,295.8602 207.0009,295.4101 202.6623,289.5172 C197.5961,295.9891 191.9823,293.2792 189.1656,287.1146 C184.6587,292.9086 178.5827,292.9076 175.6656,285.49 C172.2076,290.5435 167.1534,290.7863 163.8625,285.3029 C158.1207,292.3584 153.3187,289.9661 149.3295,283.4291 C139.0723,282.4509 135.7337,274.6108 143.0239,266.9275 C138.5665,258.1177 141.0213,253.57 150.5451,251.6378 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="93" x="155.5" y="272.0952">mvn package</text></g><!--entity Jar--><g id="elem_Jar"><rect fill="#FFFFFF" height="40.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="162" x="121" y="351.03"/><polygon fill="#FFFFFF" points="266,356.03,266,370.03,278,370.03,278,362.03,272,356.03,266,356.03" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="272" x2="272" y1="356.03" y2="362.03"/><line style="stroke:#000000;stroke-width:1.0;" x1="278" x2="272" y1="362.03" y2="362.03"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="131" y="378.1052">product-service.jar</text></g><!--entity Src--><g id="elem_Src"><rect fill="#FFFFFF" height="40.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="166" x="91" y="140"/><polygon fill="#FFFFFF" points="240,145,240,159,252,159,252,151,246,145,240,145" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="246" x2="246" y1="145" y2="151"/><line style="stroke:#000000;stroke-width:1.0;" x1="252" x2="246" y1="151" y2="151"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="136" x="101" y="167.0752">Code source (.java)</text></g><!--entity pom.xml--><g id="elem_pom.xml"><rect fill="#FFFFFF" height="40.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="92" x="292" y="140"/><polygon fill="#FFFFFF" points="367,145,367,159,379,159,379,151,373,145,367,145" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="373" x2="373" y1="145" y2="151"/><line style="stroke:#000000;stroke-width:1.0;" x1="379" x2="373" y1="151" y2="151"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="62" x="302" y="167.0752">pom.xml</text></g><!--entity BaseProd--><g id="elem_BaseProd"><polygon fill="#FFFFFF" points="51.5,538.05,61.5,528.05,226.5,528.05,226.5,565.0646,216.5,575.0646,51.5,575.0646,51.5,538.05" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="216.5" x2="226.5" y1="538.05" y2="528.05"/><line style="stroke:#000000;stroke-width:1.0;" x1="51.5" x2="216.5" y1="538.05" y2="538.05"/><line style="stroke:#000000;stroke-width:1.0;" x1="216.5" x2="216.5" y1="538.05" y2="575.0646"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="45" x="66.5" y="562.1252">Image</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="5" x="111.5" y="562.1252">&#160;</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="25" x="116.5" y="562.1252">JRE</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="5" x="141.5" y="562.1252">&#160;</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="55" x="146.5" y="562.1252">(l&#233;g&#232;re)</text></g><!--entity FinalJar--><g id="elem_FinalJar"><rect fill="#FFFFFF" height="40.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="162" x="262" y="531.55"/><polygon fill="#FFFFFF" points="407,536.55,407,550.55,419,550.55,419,542.55,413,536.55,407,536.55" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="413" x2="413" y1="536.55" y2="542.55"/><line style="stroke:#000000;stroke-width:1.0;" x1="419" x2="413" y1="542.55" y2="542.55"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="272" y="558.6252">product-service.jar</text></g><!--link Src to MvnCmd--><g id="link_Src_MvnCmd"><path d="M179.14,180.18 C183.87,197.86 189.3588,218.324 194.3688,237.044 " fill="none" id="Src-to-MvnCmd" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="195.92,242.84,197.4572,233.1119,194.6274,238.01,189.7292,235.1801,195.92,242.84" style="stroke:#000000;stroke-width:1.0;"/></g><!--link pom.xml to MvnCmd--><g id="link_pom.xml_MvnCmd"><path d="M312.74,180.42 C289.85,198.01 260.8477,220.3043 236.6277,238.9143 " fill="none" id="pom.xml-to-MvnCmd" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="231.87,242.57,241.4437,240.2583,235.8348,239.5236,236.5694,233.9146,231.87,242.57" style="stroke:#000000;stroke-width:1.0;"/></g><!--link MvnCmd to Jar--><g id="link_MvnCmd_Jar"><path d="M202,290.53 C202,308.59 202,327.47 202,344.56 " fill="none" id="MvnCmd-to-Jar" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="202,350.56,206,341.56,202,345.56,198,341.56,202,350.56" style="stroke:#000000;stroke-width:1.0;"/></g><!--link Jar to FinalJar--><g id="link_Jar_FinalJar"><path d="M207.95,391.53 C215.34,413.6 229.54,449.89 250,476.05 C267.21,498.04 287.1833,514.1643 306.8933,527.6943 " fill="none" id="Jar-to-FinalJar" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#000000" points="311.84,531.09,306.6838,522.6987,307.7178,528.2603,302.1562,529.2943,311.84,531.09" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="127" x="309.5" y="437.1198">COPY --from=build</text><path d="M255,445.8493 L255,470.8493 L491,470.8493 L491,455.8493 L481,445.8493 L255,445.8493 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M481,445.8493 L481,455.8493 L491,455.8493 L481,445.8493 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="215" x="261" y="463.9191">On copie uniquement l'artefact !</text></g><!--SRC=[bLBBJiCm4BpxAxRXG2kKID1R9NeW3H95LIjwGeY3SPnWuaTmx0W9zN_WE_fZs748bNX8x25sPdV6ksEFp2CL56gEcKHDnMIDDHQWAJ5Obfp2Am8N5qhdLAUAAmr7q-aqW9XKfLPMvdqYopAqGwXsE2ufH0j5AgeBvcHMbXiMRut3erwpS0UveWw3KvZ1XMKyZm0tOHSIeTQ7LBahln8UNIwkuGHMkAKo4713Ez91lG-i3IimCH2bdjqegmc5SVA4Mppfc5jDVc7KIYGlWaT3UZVi25SsXqYq4lfXEwrLArEHen-ajCejCN53TSi8TSVhZh346WNbxuwSEKSsWSTKcDB__kdAJGPZldylzs-QJWPZFEqVJLqoYVbNPwutvn74yVnplhlUcVj3C2mTuhd8VI19veEQcoPTRsvTGQ6LE7_mbuMaCXIK1CvaDOEr1A9gHi5AzcpTivG6-B5hc7ODZz07]--></g></svg></div></section></section><section class="chapter"><h2 id="tp-dockerisation-de-product-service" data-toc="tp-dockerisation-de-product-service">TP : Dockerisation de <code class="code" id="-1w6eyk_71">product-service</code></h2><section class="procedure-steps" id="-1w6eyk_69"><p id="-1w6eyk_72"><b id="-1w6eyk_97">Pr&eacute;-requis :</b> Assurez-vous que Docker Desktop (ou l'&eacute;quivalent sur votre OS) est install&eacute; et en cours d'ex&eacute;cution sur votre machine.</p><p id="-1w6eyk_73"><b id="-1w6eyk_98">&Eacute;tape 1 : Packaging de l'application</b></p><p id="-1w6eyk_74">Avant de construire l'image, nous avons besoin du fichier <code class="code" id="-1w6eyk_99">.jar</code>. Ouvrez un terminal &agrave; la racine de votre projet <code class="code" id="-1w6eyk_100">product-service</code> et ex&eacute;cutez la commande Maven :</p><p id="-1w6eyk_76">Cette commande va compiler votre code, lancer les tests et cr&eacute;er un fichier <code class="code" id="-1w6eyk_101">product-service-0.0.1-SNAPSHOT.jar</code> dans le r&eacute;pertoire <code class="code" id="-1w6eyk_102">target</code>.</p><p id="-1w6eyk_77"><b id="-1w6eyk_103">&Eacute;tape 2 : Cr&eacute;ation du Dockerfile</b></p><p id="-1w6eyk_78">&Agrave; la racine de votre projet <code class="code" id="-1w6eyk_104">product-service</code> (au m&ecirc;me niveau que <code class="code" id="-1w6eyk_105">pom.xml</code>), cr&eacute;ez un nouveau fichier nomm&eacute; <code class="code" id="-1w6eyk_106">Dockerfile</code> (sans extension).</p><p id="-1w6eyk_79">Copiez-y le contenu suivant :</p><div class="code-block" data-lang="dockerfile">
# ----- STAGE 1: Build -----
# On utilise une image officielle Maven avec une version de Java 17
# On nomme cette étape &quot;build&quot; pour pouvoir s'y référer plus tard.
FROM maven:3.8.5-openjdk-17 AS build

# On définit le répertoire de travail dans l'image
WORKDIR /app

# On copie d'abord le pom.xml pour tirer parti du cache Docker.
# Si le pom.xml ne change pas, Docker n'aura pas à ré-télécharger
# les dépendances à chaque build.
COPY pom.xml .
RUN mvn dependency:go-offline

# On copie le reste du code source
COPY src ./src

# On lance la compilation et la création du .jar
# -DskipTests pour ne pas relancer les tests dans Docker
RUN mvn package -DskipTests


# ----- STAGE 2: Runtime -----
# On part d'une image légère contenant uniquement le JRE 17
FROM eclipse-temurin:17-jre-focal

# On définit le répertoire de travail
WORKDIR /app

# On copie UNIQUEMENT le .jar généré depuis l'étape &quot;build&quot;
COPY --from=build /app/target/*.jar app.jar

# On expose le port sur lequel notre application tourne à l'intérieur
# du conteneur. C'est le port 8081 que nous avons défini.
EXPOSE 8081

# C'est la commande qui sera exécutée au démarrage du conteneur
ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]
</div><p id="-1w6eyk_81"><b id="-1w6eyk_107">&Eacute;tape 3 : Construction de l'image Docker</b></p><p id="-1w6eyk_82">Dans votre terminal, toujours &agrave; la racine du projet, lancez la commande de build :</p><ul class="list _bullet" id="-1w6eyk_84"><li class="list__item" id="-1w6eyk_108"><p><code class="code" id="-1w6eyk_111">docker build</code>: la commande pour construire une image.</p></li><li class="list__item" id="-1w6eyk_109"><p><code class="code" id="-1w6eyk_112">-t product-service:1.0</code>: l'option <code class="code" id="-1w6eyk_113">-t</code> (tag) permet de nommer notre image. Ici, <code class="code" id="-1w6eyk_114">product-service</code> est le nom et <code class="code" id="-1w6eyk_115">1.0</code> est la version.</p></li><li class="list__item" id="-1w6eyk_110"><p><code class="code" id="-1w6eyk_116">.</code>: indique que le contexte de build (o&ugrave; trouver le Dockerfile et les fichiers &agrave; copier) est le r&eacute;pertoire courant.</p></li></ul><p id="-1w6eyk_85">Docker va maintenant ex&eacute;cuter chaque instruction du Dockerfile. Cela peut prendre un peu de temps la premi&egrave;re fois.</p><p id="-1w6eyk_86"><b id="-1w6eyk_117">&Eacute;tape 4 : Lancement du conteneur</b></p><p id="-1w6eyk_87">Une fois l'image construite, nous pouvons lancer un conteneur bas&eacute; sur celle-ci :</p><ul class="list _bullet" id="-1w6eyk_89"><li class="list__item" id="-1w6eyk_118"><p><code class="code" id="-1w6eyk_123">docker run</code>: la commande pour lancer un conteneur.</p></li><li class="list__item" id="-1w6eyk_119"><p><code class="code" id="-1w6eyk_124">-d</code>: (detach) pour lancer le conteneur en arri&egrave;re-plan.</p></li><li class="list__item" id="-1w6eyk_120"><p><code class="code" id="-1w6eyk_125">-p 8081:8081</code>: c'est tr&egrave;s important ! On mappe le port 8081 de notre machine (host) vers le port 8081 du conteneur (celui qu'on a expos&eacute;).</p></li><li class="list__item" id="-1w6eyk_121"><p><code class="code" id="-1w6eyk_126">--name my-product-service</code>: on donne un nom lisible &agrave; notre conteneur.</p></li><li class="list__item" id="-1w6eyk_122"><p><code class="code" id="-1w6eyk_127">product-service:1.0</code>: le nom de l'image &agrave; utiliser.</p></li></ul><p id="-1w6eyk_90"><b id="-1w6eyk_128">&Eacute;tape 5 : Validation</b></p><p id="-1w6eyk_91">V&eacute;rifiez que votre conteneur est bien en cours d'ex&eacute;cution :</p><p id="-1w6eyk_93">Vous devriez voir une ligne avec le nom <code class="code" id="-1w6eyk_129">my-product-service</code>.</p><p id="-1w6eyk_94">Maintenant, testez l'API exactement comme avant. Ouvrez votre client HTTP et faites l'appel :</p><p> <code class="code" id="-1w6eyk_95">### Get all products (from Docker container) GET http://localhost:8081/api/products Accept: application/json</code></p><p id="-1w6eyk_96">Magique ! Vous devriez recevoir la m&ecirc;me r&eacute;ponse JSON. Votre application tourne maintenant dans un conteneur isol&eacute;, mais elle est accessible depuis votre machine gr&acirc;ce au mappage de port.</p><ol class="list _decimal"></ol></section></section><section class="chapter"><h2 id="exercice-4-configurer-le-conteneur-au-lancement" data-toc="exercice-4-configurer-le-conteneur-au-lancement">Exercice 4 : Configurer le conteneur au lancement</h2><p id="-1w6eyk_130"><span class="control" id="-1w6eyk_135">Contexte :</span> Parfois, on veut pouvoir changer une configuration sans avoir &agrave; reconstruire l'image Docker. Spring Boot est tr&egrave;s dou&eacute; pour lire les variables d'environnement. On peut s'en servir pour surcharger les propri&eacute;t&eacute;s de <code class="code" id="-1w6eyk_136">application.properties</code>.</p><p id="-1w6eyk_131"><span class="control" id="-1w6eyk_137">Votre mission :</span></p><ol class="list _decimal" id="-1w6eyk_132" type="1"><li class="list__item" id="-1w6eyk_138"><p id="-1w6eyk_141">Arr&ecirc;tez et supprimez le conteneur pr&eacute;c&eacute;dent (<code class="code" id="-1w6eyk_142">docker stop my-product-service</code> puis <code class="code" id="-1w6eyk_143">docker rm my-product-service</code>).</p></li><li class="list__item" id="-1w6eyk_139"><p id="-1w6eyk_144">Relancez le conteneur <code class="code" id="-1w6eyk_146">product-service</code> en utilisant la m&ecirc;me image, mais cette fois-ci, demandez-lui de d&eacute;marrer sur le port <span class="control" id="-1w6eyk_147">9090</span> au lieu du port 8081. Vous devrez pour cela :</p><ul class="list _bullet" id="-1w6eyk_145"><li class="list__item" id="-1w6eyk_148"><p id="-1w6eyk_150">Modifier le mappage de port.</p></li><li class="list__item" id="-1w6eyk_149"><p id="-1w6eyk_151">Passer une variable d'environnement au conteneur pour surcharger la propri&eacute;t&eacute; <code class="code" id="-1w6eyk_152">server.port</code>.</p></li></ul></li><li class="list__item" id="-1w6eyk_140"><p id="-1w6eyk_153">Validez que vous pouvez appeler l'API sur <code class="code" id="-1w6eyk_154">http://localhost:9090/api/products</code>.</p></li></ol><p id="-1w6eyk_133"><span class="control" id="-1w6eyk_155">Indice :</span> L'option pour passer une variable d'environnement avec <code class="code" id="-1w6eyk_156">docker run</code> est <code class="code" id="-1w6eyk_157">-e</code>. Par exemple, <code class="code" id="-1w6eyk_158">-e MA_VARIABLE=ma_valeur</code>. Spring Boot reconna&icirc;t la variable d'environnement <code class="code" id="-1w6eyk_159">SERVER_PORT</code> pour surcharger <code class="code" id="-1w6eyk_160">server.port</code>.</p><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-4" data-toc="correction-exercice-4">Correction exercice 4</h3></div><div class="collapse__content"><p id="-1w6eyk_161">Voici la commande <code class="code" id="-1w6eyk_169">docker run</code> &agrave; utiliser pour accomplir cette t&acirc;che :</p><div class="code-block" data-lang="bash">
docker run -d -p 9090:9090 -e SERVER_PORT=9090 \
--name my-product-service-on-9090 product-service:1.0
</div><p id="-1w6eyk_163"><span class="control" id="-1w6eyk_170">Explication :</span></p><ul class="list _bullet" id="-1w6eyk_164"><li class="list__item" id="-1w6eyk_171"><p id="-1w6eyk_173"><code class="code" id="-1w6eyk_174">-p 9090:9090</code>: On mappe le port 9090 de notre machine au port 9090 du conteneur.</p></li><li class="list__item" id="-1w6eyk_172"><p id="-1w6eyk_175"><code class="code" id="-1w6eyk_176">-e SERVER_PORT=9090</code>: On d&eacute;finit une variable d'environnement <code class="code" id="-1w6eyk_177">SERVER_PORT</code> &agrave; l'int&eacute;rieur du conteneur. Spring Boot la d&eacute;tecte automatiquement et l'utilise pour configurer le port de son serveur embarqu&eacute;, surchargeant ainsi la valeur <code class="code" id="-1w6eyk_178">server.port=8081</code> du fichier <code class="code" id="-1w6eyk_179">application.properties</code>.</p></li></ul><p id="-1w6eyk_165"><span class="control" id="-1w6eyk_180">Validation :</span> Vous pouvez maintenant appeler votre service avec succ&egrave;s sur le nouveau port.</p><div class="code-block" data-lang="http">
### Get all products (from Docker container on port 9090)
GET http://localhost:9090/api/products
Accept: application/json
</div><p id="-1w6eyk_167">Cet exercice d&eacute;montre la flexibilit&eacute; des conteneurs : on peut adapter leur comportement au moment du lancement sans jamais toucher &agrave; l'image elle-m&ecirc;me.</p></div></div></section></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><p id="-1w6eyk_181">Prenez un moment pour r&eacute;pondre &agrave; ces questions. Les corrections se trouvent &agrave; la toute fin du support de cours.</p><ol class="list _decimal" id="-1w6eyk_182" type="1"><li class="list__item" id="-1w6eyk_184"><p id="-1w6eyk_189"><span class="control" id="-1w6eyk_190">(Question ouverte)</span> Quel est le principal avantage d'utiliser un &quot;multi-stage build&quot; dans un Dockerfile pour une application Java ?</p></li><li class="list__item" id="-1w6eyk_185"><p id="-1w6eyk_191"><span class="control" id="-1w6eyk_193">(QCM)</span> Quelle commande Docker permet de voir les conteneurs actuellement en cours d'ex&eacute;cution ?</p><ul class="list _bullet" id="-1w6eyk_192"><li class="list__item" id="-1w6eyk_194"><p id="-1w6eyk_198">A) <code class="code" id="-1w6eyk_199">docker images</code></p></li><li class="list__item" id="-1w6eyk_195"><p id="-1w6eyk_200">B) <code class="code" id="-1w6eyk_201">docker ps</code></p></li><li class="list__item" id="-1w6eyk_196"><p id="-1w6eyk_202">C) <code class="code" id="-1w6eyk_203">docker run</code></p></li><li class="list__item" id="-1w6eyk_197"><p id="-1w6eyk_204">D) <code class="code" id="-1w6eyk_205">docker build</code></p></li></ul></li><li class="list__item" id="-1w6eyk_186"><p id="-1w6eyk_206"><span class="control" id="-1w6eyk_208">(QCM)</span> Dans un <code class="code" id="-1w6eyk_209">Dockerfile</code>, quelle est la diff&eacute;rence entre l'instruction <code class="code" id="-1w6eyk_210">RUN</code> et l'instruction <code class="code" id="-1w6eyk_211">ENTRYPOINT</code>?</p><ul class="list _bullet" id="-1w6eyk_207"><li class="list__item" id="-1w6eyk_212"><p id="-1w6eyk_216">A) Il n'y a pas de diff&eacute;rence, elles sont interchangeables.</p></li><li class="list__item" id="-1w6eyk_213"><p id="-1w6eyk_217">B) <code class="code" id="-1w6eyk_218">RUN</code> ex&eacute;cute une commande pendant la construction de l'image, <code class="code" id="-1w6eyk_219">ENTRYPOINT</code> sp&eacute;cifie la commande &agrave; ex&eacute;cuter quand un conteneur est lanc&eacute;.</p></li><li class="list__item" id="-1w6eyk_214"><p id="-1w6eyk_220">C) <code class="code" id="-1w6eyk_221">ENTRYPOINT</code> ex&eacute;cute une commande pendant la construction de l'image, <code class="code" id="-1w6eyk_222">RUN</code> sp&eacute;cifie la commande &agrave; ex&eacute;cuter quand un conteneur est lanc&eacute;.</p></li><li class="list__item" id="-1w6eyk_215"><p id="-1w6eyk_223">D) <code class="code" id="-1w6eyk_224">RUN</code> est pour les commandes Linux, <code class="code" id="-1w6eyk_225">ENTRYPOINT</code> pour les commandes Java.</p></li></ul></li><li class="list__item" id="-1w6eyk_187"><p id="-1w6eyk_226"><span class="control" id="-1w6eyk_227">(Question ouverte)</span> J'ex&eacute;cute la commande <code class="code" id="-1w6eyk_228">docker run -p 8000:8081 my-app</code>. Mon application dans le conteneur &eacute;coute sur le port 8081. Sur quelle URL devrais-je faire mon appel API depuis ma machine h&ocirc;te ?</p></li><li class="list__item" id="-1w6eyk_188"><p id="-1w6eyk_229"><span class="control" id="-1w6eyk_231">(QCM)</span> Dans notre <code class="code" id="-1w6eyk_232">Dockerfile</code>, pourquoi copions-nous d'abord le <code class="code" id="-1w6eyk_233">pom.xml</code> seul, avant de copier le reste du code source ?</p><ul class="list _bullet" id="-1w6eyk_230"><li class="list__item" id="-1w6eyk_234"><p id="-1w6eyk_238">A) Pour que l'image soit plus petite.</p></li><li class="list__item" id="-1w6eyk_235"><p id="-1w6eyk_239">B) Pour des raisons de s&eacute;curit&eacute;.</p></li><li class="list__item" id="-1w6eyk_236"><p id="-1w6eyk_240">C) Pour profiter du syst&egrave;me de cache de Docker et acc&eacute;l&eacute;rer les builds futurs.</p></li><li class="list__item" id="-1w6eyk_237"><p id="-1w6eyk_241">D) Parce que le <code class="code" id="-1w6eyk_242">pom.xml</code> doit &ecirc;tre dans un r&eacute;pertoire diff&eacute;rent.</p></li></ul></li></ol></section><section class="chapter"><h2 id="conclusion" data-toc="conclusion">Conclusion</h2><p id="-1w6eyk_243">Bravo ! Vous avez dockeris&eacute; votre premier microservice. Vous avez transform&eacute; votre code source et votre projet Maven en une <span class="control" id="-1w6eyk_246">unit&eacute; de d&eacute;ploiement standard, portable et isol&eacute;e</span>. Vous avez appris &agrave; &eacute;crire un <code class="code" id="-1w6eyk_247">Dockerfile</code> optimis&eacute;, &agrave; construire une image et &agrave; lancer un conteneur.</p><p id="-1w6eyk_244">Ce n'est pas juste un exercice technique. C'est une comp&eacute;tence fondamentale dans l'&eacute;cosyst&egrave;me microservices. Tous les services que nous allons cr&eacute;er par la suite seront syst&eacute;matiquement dockeris&eacute;s. Cela nous permettra de les g&eacute;rer, de les lier et de les orchestrer facilement.</p><p id="-1w6eyk_245">Maintenant que nous avons une brique logicielle bien empaquet&eacute;e, il est temps de s'attaquer au c&oelig;ur du sujet : comment faire en sorte que nos briques communiquent entre elles ? C'est l'objet du prochain module, o&ugrave; nous explorerons les diff&eacute;rentes strat&eacute;gies de communication inter-services.</p></section><div class="last-modified">17 juillet 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="002-00-first-micro-service.html" class="navigation-links__prev">Module 2 : Cas d'&eacute;tude et Premier Microservice</a><a href="003-00-service-communication.html" class="navigation-links__next">Module 3 : La Grande Conversation - Communication Inter-services</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>