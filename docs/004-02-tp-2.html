<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-31T08:30:08.528081"><title>TP 2 : Construction du Phare - Mise en place du Serveur de D&eacute;couverte Eureka | Spring Micro Services</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs Pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction-b-tir-notre-tour-de-contr-le","level":0,"title":"Introduction : Bâtir notre tour de contrôle","anchor":"#introduction-b-tir-notre-tour-de-contr-le"},{"id":"tp-cr-ation-du-serveur-eureka","level":0,"title":"TP : Création du Serveur Eureka","anchor":"#tp-cr-ation-du-serveur-eureka"},{"id":"dockerisation-de-eureka-server","level":0,"title":"Dockerisation de eureka-server","anchor":"#dockerisation-de-eureka-server"},{"id":"exercice-5-comprendre-la-configuration-d-eureka","level":0,"title":"Exercice 5 : Comprendre la configuration d\u0027Eureka","anchor":"#exercice-5-comprendre-la-configuration-d-eureka"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"conclusion","level":0,"title":"Conclusion","anchor":"#conclusion"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="TP 2 : Construction du Phare - Mise en place du Serveur de D&eacute;couverte Eureka | Spring Micro Services"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Spring Micro Services Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/004-02-tp-2.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="TP 2 : Construction du Phare - Mise en place du Serveur de D&eacute;couverte Eureka | Spring Micro Services"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/004-02-tp-2.html#webpage",
    "url": "writerside-documentation/004-02-tp-2.html",
    "name": "TP 2 : Construction du Phare - Mise en place du Serveur de D&eacute;couverte Eureka | Spring Micro Services",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Spring Micro Services Help"
}</script><!-- End Schema.org --></head><body data-id="004-02-TP-2" data-main-title="TP 2 : Construction du Phare - Mise en place du Serveur de Découverte Eureka" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="004-00-service-discovery.md|Module 4 : La Découverte de Services - Qui est où ? (L'essentiel)"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Spring Micro Services  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="004-02-TP-2" id="004-02-TP-2.md">TP 2 : Construction du Phare - Mise en place du Serveur de Découverte Eureka</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs P&eacute;dagogiques</h2><p id="z4h9u05_10">&Agrave; la fin de ce TP, vous serez capable de :</p><ul class="list _bullet" id="z4h9u05_11"><li class="list__item" id="z4h9u05_12"><p id="z4h9u05_17">Cr&eacute;er un projet Spring Boot pour h&eacute;berger un serveur Eureka.</p></li><li class="list__item" id="z4h9u05_13"><p id="z4h9u05_18">Ajouter et configurer la d&eacute;pendance <code class="code" id="z4h9u05_19">eureka-server</code>.</p></li><li class="list__item" id="z4h9u05_14"><p id="z4h9u05_20">Activer le r&ocirc;le de serveur Eureka avec une seule annotation.</p></li><li class="list__item" id="z4h9u05_15"><p id="z4h9u05_21">Configurer et lancer le serveur Eureka.</p></li><li class="list__item" id="z4h9u05_16"><p id="z4h9u05_22">Dockeriser le serveur Eureka pour le rendre portable.</p></li></ul></section><section class="chapter"><h2 id="introduction-b-tir-notre-tour-de-contr-le" data-toc="introduction-b-tir-notre-tour-de-contr-le">Introduction : B&acirc;tir notre tour de contr&ocirc;le</h2><p id="z4h9u05_23">Nous avons parl&eacute; de l'annuaire, du phare, de la tour de contr&ocirc;le... Peu importe la m&eacute;taphore, le concept est le m&ecirc;me : nous avons besoin d'un service central qui sait qui est qui et qui est o&ugrave;. Ce service, c'est notre <span class="control" id="z4h9u05_26">Serveur Eureka</span>.</p><p id="z4h9u05_24">Contrairement aux autres composants de Spring Cloud que nous verrons (comme OpenFeign ou le Circuit Breaker, qui sont des d&eacute;pendances dans nos services m&eacute;tier), le serveur Eureka est une <span class="control" id="z4h9u05_27">application &agrave; part enti&egrave;re</span>. C'est un microservice dont le seul r&ocirc;le est d'&ecirc;tre un... annuaire de microservices.</p><p id="z4h9u05_25">Dans ce TP, nous allons construire ce serveur. Vous serez surpris de voir &agrave; quel point Spring Boot et Spring Cloud rendent cette t&acirc;che simple. En quelques minutes, nous aurons un serveur de d&eacute;couverte fonctionnel, pr&ecirc;t &agrave; accueillir ses premiers clients.</p></section><section class="chapter"><h2 id="tp-cr-ation-du-serveur-eureka" data-toc="tp-cr-ation-du-serveur-eureka">TP : Cr&eacute;ation du Serveur Eureka</h2><section class="procedure-steps" id="z4h9u05_28"><p id="z4h9u05_29"><b id="z4h9u05_49">&Eacute;tape 1 : Cr&eacute;ation du projet via Spring Initializr</b></p><p id="z4h9u05_30">Rendez-vous &agrave; nouveau sur <a href="https://start.spring.io/" id="z4h9u05_50" data-external="true" rel="noopener noreferrer" target="_blank">start.spring.io</a> et cr&eacute;ez un nouveau projet avec la configuration suivante :</p><ul class="list _bullet" id="z4h9u05_31"><li class="list__item" id="z4h9u05_51"><p><b id="z4h9u05_56">Project :</b> Maven Project</p></li><li class="list__item" id="z4h9u05_52"><p><b id="z4h9u05_57">Language :</b> Java</p></li><li class="list__item" id="z4h9u05_53"><p><b id="z4h9u05_58">Spring Boot :</b> 3.2.x (utilisez la m&ecirc;me version que pour <code class="code" id="z4h9u05_59">product-service</code>)</p></li><li class="list__item" id="z4h9u05_54"><p><b id="z4h9u05_60">Project Metadata :</b></p><ul class="list _bullet" id="z4h9u05_61"><li class="list__item" id="z4h9u05_62"><p><b id="z4h9u05_69">Group :</b> <code class="code" id="z4h9u05_70">fr.formation.spring</code></p></li><li class="list__item" id="z4h9u05_63"><p><b id="z4h9u05_71">Artifact :</b> <code class="code" id="z4h9u05_72">eureka-server</code></p></li><li class="list__item" id="z4h9u05_64"><p><b id="z4h9u05_73">Name :</b> <code class="code" id="z4h9u05_74">eureka-server</code></p></li><li class="list__item" id="z4h9u05_65"><p><b id="z4h9u05_75">Description :</b> Serveur de d&eacute;couverte pour l'&eacute;cosyst&egrave;me GestBook</p></li><li class="list__item" id="z4h9u05_66"><p><b id="z4h9u05_76">Package name :</b> <code class="code" id="z4h9u05_77">fr.formation.spring.eurekaserver</code></p></li><li class="list__item" id="z4h9u05_67"><p><b id="z4h9u05_78">Packaging :</b> Jar</p></li><li class="list__item" id="z4h9u05_68"><p><b id="z4h9u05_79">Java :</b> 17</p></li></ul></li><li class="list__item" id="z4h9u05_55"><p><b id="z4h9u05_80">Dependencies :</b></p><ul class="list _bullet" id="z4h9u05_81"><li class="list__item" id="z4h9u05_82"><p><code class="code" id="z4h9u05_83">Eureka Server</code>: C'est la d&eacute;pendance magique ! Elle se trouve dans la section &quot;Spring Cloud Discovery&quot;.</p></li></ul></li></ul><p id="z4h9u05_32">G&eacute;n&eacute;rez, t&eacute;l&eacute;chargez et ouvrez le projet dans votre IDE.</p><figure id="z4h9u05_33"><img alt="Spring Initializr configuration for Eureka Server" src="images/spring-project-eureka-server.png" title="Spring Initializr configuration for Eureka Server" width="1824" height="1656"></figure><p id="z4h9u05_34"><b id="z4h9u05_84">&Eacute;tape 2 : Activer le serveur Eureka</b></p><p id="z4h9u05_35">Ouvrez la classe principale de l'application, <code class="code" id="z4h9u05_85">EurekaServerApplication.java</code>.</p><p id="z4h9u05_36">Il suffit d'ajouter une seule annotation au-dessus de <code class="code" id="z4h9u05_86">@SpringBootApplication</code> pour transformer cette simple application Spring Boot en un serveur de d&eacute;couverte complet.</p><div class="code-block" data-lang="java">
// package fr.formation.spring.eurekaserver;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

@SpringBootApplication
@EnableEurekaServer // &lt;-- C'est tout ! Cette annotation active le serveur Eureka.
public class EurekaServerApplication {

    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }

}
</div><p id="z4h9u05_38">Cette annotation va d&eacute;clencher une auto-configuration qui met en place tous les endpoints et l'interface utilisateur n&eacute;cessaires au fonctionnement du serveur.</p><p id="z4h9u05_39"><b id="z4h9u05_87">&Eacute;tape 3 : Configurer l'application</b></p><p id="z4h9u05_40">Ouvrez le fichier <code class="code" id="z4h9u05_88">src/main/resources/application.properties</code>. Nous devons y ajouter quelques configurations sp&eacute;cifiques.</p><div class="code-block" data-lang="properties">
# Le nom de l'application
spring.application.name=eureka-server
# Le port sur lequel le serveur Eureka va écouter.
# 8761 est le port standard par convention pour Eureka.
server.port=8761
# Configuration spécifique à Eureka Server.
# Par défaut, un client Eureka essaie de s'enregistrer auprès d'un serveur.
# Comme notre serveur EST le serveur, nous devons désactiver ce comportement.
# On lui dit : &quot;N'essaie pas de t'enregistrer auprès de toi-même.&quot;
eureka.client.register-with-eureka=false
# On lui dit également : &quot;N'essaie pas de récupérer l'annuaire auprès
# de toi-même.&quot;
eureka.client.fetch-registry=false
</div><p id="z4h9u05_42">Ces deux derni&egrave;res lignes sont cruciales. Sans elles, votre serveur Eureka essaierait de se comporter comme un client et chercherait un autre serveur Eureka (ce qui est utile pour la haute disponibilit&eacute;, mais pas pour notre cas simple).</p><p id="z4h9u05_43"><b id="z4h9u05_89">&Eacute;tape 4 : Lancement et v&eacute;rification</b></p><p id="z4h9u05_44">Lancez l'application <code class="code" id="z4h9u05_90">EurekaServerApplication</code> depuis votre IDE.</p><p id="z4h9u05_45">Une fois qu'elle a d&eacute;marr&eacute;, ouvrez votre navigateur web et allez &agrave; l'adresse : <a href="http://localhost:8761/" id="z4h9u05_91" data-external="true" rel="noopener noreferrer" target="_blank">http://localhost:8761/</a></p><p id="z4h9u05_46">Vous devriez voir le tableau de bord d'Eureka !</p><figure id="z4h9u05_47"><img alt="eureka-dashborad.png" src="images/eureka-dashborad.png" title="eureka-dashborad.png" width="1792" height="2074"></figure><p id="z4h9u05_48">Pour l'instant, la section &quot;Instances currently registered with Eureka&quot; est vide. C'est normal, aucun service ne s'est encore enregistr&eacute;. Notre phare est construit et allum&eacute;, mais les bateaux ne savent pas encore qu'il existe.</p><ol class="list _decimal"></ol></section></section><section class="chapter"><h2 id="dockerisation-de-eureka-server" data-toc="dockerisation-de-eureka-server">Dockerisation de <code class="code" id="z4h9u05_98">eureka-server</code></h2><p id="z4h9u05_93">Comme pour notre <code class="code" id="z4h9u05_99">product-service</code>, nous allons &quot;embo&icirc;ter&quot; notre serveur Eureka pour le rendre facile &agrave; d&eacute;ployer et &agrave; orchestrer.</p><section class="procedure-steps" id="z4h9u05_94"><p id="z4h9u05_100"><b id="z4h9u05_111">&Eacute;tape 1 : Cr&eacute;ation du Dockerfile</b></p><p id="z4h9u05_101">&Agrave; la racine du projet <code class="code" id="z4h9u05_112">eureka-server</code>, cr&eacute;ez un fichier <code class="code" id="z4h9u05_113">Dockerfile</code>. Le contenu est quasiment identique &agrave; celui du <code class="code" id="z4h9u05_114">product-service</code>, ce qui montre la puissance de la standardisation.</p><div class="code-block" data-lang="dockerfile">

# ----- STAGE 1: Build -----
FROM maven:3.8.5-openjdk-17 AS build
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline
COPY src ./src
RUN mvn package -DskipTests

# ----- STAGE 2: Runtime -----
FROM eclipse-temurin:17-jre-focal
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
EXPOSE 8761
ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]
</div><p id="z4h9u05_103"><b id="z4h9u05_115">&Eacute;tape 2 : Construction de l'image Docker</b></p><p id="z4h9u05_104">Ouvrez un terminal &agrave; la racine du projet <code class="code" id="z4h9u05_116">eureka-server</code>. Assurez-vous d'avoir d'abord packag&eacute; l'application avec <code class="code" id="z4h9u05_117">mvn clean package</code>.</p><p id="z4h9u05_105">Construisez l'image :</p><p id="z4h9u05_107"><b id="z4h9u05_118">&Eacute;tape 3 : Lancement du conteneur</b></p><p id="z4h9u05_108">Arr&ecirc;tez l'application si elle tourne encore dans votre IDE. Lancez le conteneur :</p><p id="z4h9u05_110">V&eacute;rifiez &agrave; nouveau l'URL <a href="http://localhost:8761/" id="z4h9u05_119" data-external="true" rel="noopener noreferrer" target="_blank">http://localhost:8761/</a>. Le tableau de bord doit &ecirc;tre de nouveau accessible, mais cette fois-ci, il est servi depuis un conteneur Docker !</p><ol class="list _decimal"></ol></section><p id="z4h9u05_95">Diagramme de d&eacute;ploiement actuel :</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="475px" preserveAspectRatio="none" style="width:743px;height:475px;background:#FFFFFF;" version="1.1" viewBox="0 0 743 475" width="743px" zoomAndPan="magnify"><defs/><g><!--cluster host--><g id="cluster_host"><polygon fill="#FFFFFF" points="21,147.6,31,137.6,614,137.6,614,448.63,604,458.63,21,458.63,21,147.6" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="604" x2="614" y1="147.6" y2="137.6"/><line style="stroke:#000000;stroke-width:1.0;" x1="21" x2="604" y1="147.6" y2="147.6"/><line style="stroke:#000000;stroke-width:1.0;" x1="604" x2="604" y1="147.6" y2="458.63"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="169" x="229" y="164.6752">Votre Machine (Host)</text></g><!--cluster EurekaContainer--><g id="cluster_EurekaContainer"><polygon fill="#FFFFFF" points="185,332.62,195,322.62,563,322.62,563,416.63,553,426.63,185,426.63,185,332.62" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="553" x2="563" y1="332.62" y2="322.62"/><line style="stroke:#000000;stroke-width:1.0;" x1="185" x2="553" y1="332.62" y2="332.62"/><line style="stroke:#000000;stroke-width:1.0;" x1="553" x2="553" y1="332.62" y2="426.63"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="302" x="219" y="349.6952">Conteneur Docker (my-eureka-server)</text></g><!--cluster ProductContainer--><g id="cluster_ProductContainer"><polygon fill="#FFFFFF" points="53,204.6,63,194.6,445,194.6,445,288.62,435,298.62,53,298.62,53,204.6" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="435" x2="445" y1="204.6" y2="194.6"/><line style="stroke:#000000;stroke-width:1.0;" x1="53" x2="435" y1="204.6" y2="204.6"/><line style="stroke:#000000;stroke-width:1.0;" x1="435" x2="435" y1="204.6" y2="298.62"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="316" x="87" y="221.6752">Conteneur Docker (my-product-service)</text></g><!--entity p_host_eureka--><g id="elem_p_host_eureka"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="109" x="461.5" y="235.6"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="550.5" y="240.6"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="548.5" y="242.6"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="548.5" y="246.6"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="476.5" y="269.6752">Port 8761</text></g><!--entity p_host_product--><g id="elem_p_host_product"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="109" x="59.5" y="363.62"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="148.5" y="368.62"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="146.5" y="370.62"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="146.5" y="374.62"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="74.5" y="397.6952">Port 8081</text></g><!--entity eureka-server.jar--><g id="elem_eureka-server.jar"><rect fill="#FFFFFF" height="40.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="150" x="253" y="367.12"/><polygon fill="#FFFFFF" points="386,372.12,386,386.12,398,386.12,398,378.12,392,372.12,386,372.12" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="392" x2="392" y1="372.12" y2="378.12"/><line style="stroke:#000000;stroke-width:1.0;" x1="398" x2="392" y1="378.12" y2="378.12"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120" x="263" y="394.1952">eureka-server.jar</text></g><!--entity p_eureka--><g id="elem_p_eureka"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="109" x="437.5" y="363.62"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="526.5" y="368.62"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="524.5" y="370.62"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="524.5" y="374.62"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="452.5" y="397.6952">Port 8761</text></g><!--entity product-service.jar--><g id="elem_product-service.jar"><rect fill="#FFFFFF" height="40.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="162" x="214" y="239.1"/><polygon fill="#FFFFFF" points="359,244.1,359,258.1,371,258.1,371,250.1,365,244.1,359,244.1" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="365" x2="365" y1="244.1" y2="250.1"/><line style="stroke:#000000;stroke-width:1.0;" x1="371" x2="365" y1="250.1" y2="250.1"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="224" y="266.1752">product-service.jar</text></g><!--entity p_product--><g id="elem_p_product"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="109" x="69.5" y="235.6"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="158.5" y="240.6"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="156.5" y="242.6"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="156.5" y="246.6"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="84.5" y="269.6752">Port 8081</text></g><g id="elem_N1"><path d="M476,11 L476,52.5986 L736,52.5986 L736,21 L726,11 L476,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M726,11 L726,21 L736,21 L726,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="203" x="482" y="29.0698">Les deux conteneurs tournent,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="239" x="482" y="44.8691">mais ne se connaissent pas encore.</text></g><!--link p_host_eureka to p_eureka--><g id="link_p_host_eureka_p_eureka"><path d="M511.65,282.93 C507.3,305.77 500.65,340.69 496.31,363.47 " fill="none" id="p_host_eureka-p_eureka" style="stroke:#000000;stroke-width:1.0;"/></g><!--link p_product to p_host_product--><g id="link_p_product_p_host_product"><path d="M122.19,282.93 C120.38,305.77 117.61,340.69 115.8,363.47 " fill="none" id="p_product-p_host_product" style="stroke:#000000;stroke-width:1.0;"/></g><!--link N1 to host--><g id="link_N1_host"><path d="M606,52.8 C606,66.37 606,85.695 606,107.1206 C606,112.477 606,117.9647 606,123.5266 C606,126.3076 606,129.107 606,131.9179 C606,133.3234 606,134.7317 606,136.142 C606,136.4945 606,136.8472 606,137.2 " fill="none" id="N1-host" style="stroke:#000000;stroke-width:1.0;"/></g><!--SRC=[XPBDJiCm48JlVeh5foBXYbwWTq3YqAAUE24XorcKjCGRhJS8XFhk-AUX2I3gaptvPZCZ-qngR16wLzjufJm90kWL1gYmVmT7Nj1Zpm64UlRevUB9jxO9u1429i37KuWVeBC1q3jYd6k8-uT56bWXw4SIHbXRLpVHDhkd8ESPgUCEFXN4LSYRuOTmIsw73BFsmyGZxgm9o6_8nNYNfKJ7t14hCzAoBCsBTG9wOfjlBUjlo57RKMe3UaCiiBo-MkIvtNDnPNAlJh0f_c38x4G2OuxpJdNicAhUIKxRE2mjDqNyg-Qevm_hjEdl-9VB8Vx1-5_N8voB3OvnsOC6fZUZcNkbykL6rQINy0K0]--></g></svg></div></section><section class="chapter"><h2 id="exercice-5-comprendre-la-configuration-d-eureka" data-toc="exercice-5-comprendre-la-configuration-d-eureka">Exercice 5 : Comprendre la configuration d'Eureka</h2><p id="z4h9u05_120"><span class="control" id="z4h9u05_124">Contexte :</span> Un coll&egrave;gue a configur&eacute; un serveur Eureka, mais il a oubli&eacute; les deux lignes de configuration cruciales : <code class="code" id="z4h9u05_125">eureka.client.register-with-eureka=false</code> et <code class="code" id="z4h9u05_126">eureka.client.fetch-registry=false</code>.</p><p id="z4h9u05_121"><span class="control" id="z4h9u05_127">Votre mission :</span></p><ol class="list _decimal" id="z4h9u05_122" type="1"><li class="list__item" id="z4h9u05_128"><p id="z4h9u05_131">Pr&eacute;disez ce qu'il va se passer au d&eacute;marrage du serveur Eureka. Regardez les logs de la console.</p></li><li class="list__item" id="z4h9u05_129"><p id="z4h9u05_132">Expliquez avec vos propres mots pourquoi ce comportement se produit.</p></li><li class="list__item" id="z4h9u05_130"><p id="z4h9u05_133">Comment l'oubli de ces lignes pourrait-il devenir un comportement souhait&eacute; dans un contexte de production plus complexe ?</p></li></ol><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-5" data-toc="correction-exercice-5">Correction exercice 5</h3></div><div class="collapse__content"><ol class="list _decimal" id="z4h9u05_134" type="1"><li class="list__item" id="z4h9u05_136"><p id="z4h9u05_139"><span class="control" id="z4h9u05_140">Pr&eacute;diction du comportement :</span> Au d&eacute;marrage, si vous regardez les logs, vous verrez de nombreux messages d'erreur. Le serveur Eureka va essayer de contacter une URL (probablement <code class="code" id="z4h9u05_141">http://localhost:8761/eureka/</code>) pour s'enregistrer et r&eacute;cup&eacute;rer l'annuaire. Comme il est lui-m&ecirc;me le destinataire de ces requ&ecirc;tes, il va boucler sur lui-m&ecirc;me en essayant de se joindre, ce qui g&eacute;n&egrave;re des erreurs de connexion (timeouts, connection refused, etc.). Le serveur d&eacute;marrera quand m&ecirc;me, mais les logs seront pollu&eacute;s par ces tentatives infructueuses.</p></li><li class="list__item" id="z4h9u05_137"><p id="z4h9u05_142"><span class="control" id="z4h9u05_143">Explication :</span> La d&eacute;pendance <code class="code" id="z4h9u05_144">eureka-server</code> inclut &eacute;galement la d&eacute;pendance <code class="code" id="z4h9u05_145">eureka-client</code>. Par d&eacute;faut, toute application ayant <code class="code" id="z4h9u05_146">eureka-client</code> dans son classpath essaie de se comporter comme un client. Elle cherche donc un serveur Eureka (d&eacute;fini par <code class="code" id="z4h9u05_147">eureka.client.serviceUrl.defaultZone</code>, qui par d&eacute;faut pointe sur lui-m&ecirc;me) pour s'enregistrer et r&eacute;cup&eacute;rer la liste des autres services. En omettant les deux lignes, on ne d&eacute;sactive pas ce comportement d'auto-enregistrement.</p></li><li class="list__item" id="z4h9u05_138"><p id="z4h9u05_148"><span class="control" id="z4h9u05_151">Cas d'utilisation en production :</span> Ce comportement est d&eacute;sir&eacute; lorsqu'on met en place une <span class="control" id="z4h9u05_152">haute disponibilit&eacute;</span> pour le serveur Eureka lui-m&ecirc;me. On peut lancer plusieurs instances d'Eureka Server (des &quot;peers&quot;). Dans ce cas, on veut que chaque serveur Eureka s'enregistre aupr&egrave;s des autres. Si un serveur tombe, les clients peuvent basculer sur les autres serveurs Eureka encore disponibles. La configuration ressemblerait alors &agrave; quelque chose comme :</p><div class="code-block" data-lang="properties">
# Pour le serveur 1
eureka.client.serviceUrl.defaultZone=http://server2.domain:8761/eureka/
# Pour le serveur 2
eureka.client.serviceUrl.defaultZone=http://server1.domain:8761/eureka/
</div><p id="z4h9u05_150">Dans ce sc&eacute;nario, <code class="code" id="z4h9u05_153">register-with-eureka</code> et <code class="code" id="z4h9u05_154">fetch-registry</code> resteraient &agrave; <code class="code" id="z4h9u05_155">true</code>.</p></li></ol></div></div></section></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><p id="z4h9u05_156">Prenez un moment pour r&eacute;pondre &agrave; ces questions. Les corrections se trouvent &agrave; la toute fin du support de cours.</p><ol class="list _decimal" id="z4h9u05_157" type="1"><li class="list__item" id="z4h9u05_159"><p id="z4h9u05_164"><span class="control" id="z4h9u05_166">(QCM)</span> Quelle annotation transforme une application Spring Boot en serveur de d&eacute;couverte ?</p><ul class="list _bullet" id="z4h9u05_165"><li class="list__item" id="z4h9u05_167"><p id="z4h9u05_171">A) <code class="code" id="z4h9u05_172">@EnableEurekaClient</code></p></li><li class="list__item" id="z4h9u05_168"><p id="z4h9u05_173">B) <code class="code" id="z4h9u05_174">@EnableDiscoveryClient</code></p></li><li class="list__item" id="z4h9u05_169"><p id="z4h9u05_175">C) <code class="code" id="z4h9u05_176">@EnableEurekaServer</code></p></li><li class="list__item" id="z4h9u05_170"><p id="z4h9u05_177">D) <code class="code" id="z4h9u05_178">@SpringBootApplication</code></p></li></ul></li><li class="list__item" id="z4h9u05_160"><p id="z4h9u05_179"><span class="control" id="z4h9u05_180">(Question ouverte)</span> Quel est le port par d&eacute;faut conventionnel pour un serveur Eureka et pourquoi est-ce une bonne pratique de le respecter si possible ?</p></li><li class="list__item" id="z4h9u05_161"><p id="z4h9u05_181"><span class="control" id="z4h9u05_183">(QCM)</span> &Agrave; quoi sert la configuration <code class="code" id="z4h9u05_184">eureka.client.register-with-eureka=false</code>?</p><ul class="list _bullet" id="z4h9u05_182"><li class="list__item" id="z4h9u05_185"><p id="z4h9u05_189">A) &Agrave; emp&ecirc;cher les clients de s'enregistrer sur ce serveur.</p></li><li class="list__item" id="z4h9u05_186"><p id="z4h9u05_190">B) &Agrave; emp&ecirc;cher le serveur de s'enregistrer lui-m&ecirc;me en tant que client.</p></li><li class="list__item" id="z4h9u05_187"><p id="z4h9u05_191">C) &Agrave; d&eacute;sactiver compl&egrave;tement le serveur Eureka.</p></li><li class="list__item" id="z4h9u05_188"><p id="z4h9u05_192">D) &Agrave; rendre l'enregistrement plus rapide.</p></li></ul></li><li class="list__item" id="z4h9u05_162"><p id="z4h9u05_193"><span class="control" id="z4h9u05_194">(Question ouverte)</span> J'ai lanc&eacute; mon conteneur Eureka avec <code class="code" id="z4h9u05_195">docker run -p 8761:8761 ...</code>. Mon <code class="code" id="z4h9u05_196">product-service</code> (qui n'est pas encore dans Docker) doit s'enregistrer. Quelle URL de serveur Eureka dois-je configurer dans son <code class="code" id="z4h9u05_197">application.properties</code>?</p></li><li class="list__item" id="z4h9u05_163"><p id="z4h9u05_198"><span class="control" id="z4h9u05_200">(QCM)</span> Apr&egrave;s avoir lanc&eacute; le serveur Eureka pour la premi&egrave;re fois, que voit-on dans la section &quot;Instances currently registered with Eureka&quot; du tableau de bord ?</p><ul class="list _bullet" id="z4h9u05_199"><li class="list__item" id="z4h9u05_201"><p id="z4h9u05_205">A) La liste de tous les services de mon ordinateur.</p></li><li class="list__item" id="z4h9u05_202"><p id="z4h9u05_206">B) Le serveur Eureka lui-m&ecirc;me.</p></li><li class="list__item" id="z4h9u05_203"><p id="z4h9u05_207">C) Une liste vide.</p></li><li class="list__item" id="z4h9u05_204"><p id="z4h9u05_208">D) Une erreur.</p></li></ul></li></ol></section><section class="chapter"><h2 id="conclusion" data-toc="conclusion">Conclusion</h2><p id="z4h9u05_209">Et voil&agrave; ! En quelques &eacute;tapes simples, nous avons assembl&eacute; et lanc&eacute; un composant critique de notre infrastructure. Notre serveur Eureka est en place, dockeris&eacute;, et attend patiemment que des services viennent s'annoncer.</p><p id="z4h9u05_210">Vous avez vu &agrave; quel point Spring Cloud simplifie la mise en &oelig;uvre de patterns d'architecture complexes. Une d&eacute;pendance, une annotation, quelques lignes de configuration, et nous avons un Service Registry fonctionnel.</p><p id="z4h9u05_211">Le phare est allum&eacute;. Dans le prochain TP, nous allons enfin guider notre premier navire, le <code class="code" id="z4h9u05_212">product-service</code>, pour qu'il s'amarre au port d'Eureka. Nous allons le transformer en client Eureka et le voir appara&icirc;tre comme par magie dans le tableau de bord.</p></section><div class="last-modified">17 juillet 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="004-00-service-discovery.html" class="navigation-links__prev">Module 4 : La D&eacute;couverte de Services - Qui est o&ugrave; ? (L'essentiel)</a><a href="004-02-tp-3.html" class="navigation-links__next">TP 3 : &quot;Je suis l&agrave; !&quot; - Enregistrement des services aupr&egrave;s d'Eureka</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>