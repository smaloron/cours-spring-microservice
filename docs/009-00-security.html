<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-27T21:24:57.221454"><title>Module 9 : S&eacute;curit&eacute; Avanc&eacute;e avec Spring Security &amp; OAuth2/OIDC (L'essentiel) | Spring Micro Services</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs Pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction-qui-tes-vous-et-qu-avez-vous-le-droit-de-faire","level":0,"title":"Introduction : Qui êtes-vous et qu\u0027avez-vous le droit de faire ?","anchor":"#introduction-qui-tes-vous-et-qu-avez-vous-le-droit-de-faire"},{"id":"le-laissez-passer-json-web-token-jwt","level":0,"title":"Le Laissez-passer : JSON Web Token (JWT)","anchor":"#le-laissez-passer-json-web-token-jwt"},{"id":"l-agence-de-s-curit-oauth2-openid-connect-oidc","level":0,"title":"L\u0027Agence de Sécurité : OAuth2 \u0026 OpenID Connect (OIDC)","anchor":"#l-agence-de-s-curit-oauth2-openid-connect-oidc"},{"id":"le-flux-de-s-curisation-dans-notre-architecture","level":0,"title":"Le Flux de Sécurisation dans notre Architecture","anchor":"#le-flux-de-s-curisation-dans-notre-architecture"},{"id":"notre-bo-te-outils","level":0,"title":"Notre Boîte à Outils","anchor":"#notre-bo-te-outils"},{"id":"conclusion-de-la-partie","level":0,"title":"Conclusion de la partie","anchor":"#conclusion-de-la-partie"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 9 : S&eacute;curit&eacute; Avanc&eacute;e avec Spring Security &amp; OAuth2/OIDC (L'essentiel) | Spring Micro Services"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Spring Micro Services Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/009-00-security.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 9 : S&eacute;curit&eacute; Avanc&eacute;e avec Spring Security &amp; OAuth2/OIDC (L'essentiel) | Spring Micro Services"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/009-00-security.html#webpage",
    "url": "writerside-documentation/009-00-security.html",
    "name": "Module 9 : S&eacute;curit&eacute; Avanc&eacute;e avec Spring Security &amp; OAuth2/OIDC (L'essentiel) | Spring Micro Services",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Spring Micro Services Help"
}</script><!-- End Schema.org --></head><body data-id="009-00-security" data-main-title="Module 9 : Sécurité Avancée avec Spring Security & OAuth2/OIDC (L'essentiel)" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Spring Micro Services  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="009-00-security" id="009-00-security.md">Module 9 : Sécurité Avancée avec Spring Security & OAuth2/OIDC (L'essentiel)</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs P&eacute;dagogiques</h2><p id="-2b6p8k_11">&Agrave; la fin de cette partie, vous serez capable de :</p><ul class="list _bullet" id="-2b6p8k_12"><li class="list__item" id="-2b6p8k_13"><p id="-2b6p8k_17">Expliquer ce qu'est un JWT, sa structure et son r&ocirc;le dans une authentification stateless.</p></li><li class="list__item" id="-2b6p8k_14"><p id="-2b6p8k_18">D&eacute;mystifier les concepts cl&eacute;s d'OAuth2 et OIDC : les r&ocirc;les (Resource Owner, Client, etc.) et la diff&eacute;rence entre autorisation et authentification.</p></li><li class="list__item" id="-2b6p8k_15"><p id="-2b6p8k_19">D&eacute;crire le r&ocirc;le d'un serveur d'autorisation comme Keycloak.</p></li><li class="list__item" id="-2b6p8k_16"><p id="-2b6p8k_20">Comprendre le flux de s&eacute;curisation : le client obtient un token, le pr&eacute;sente &agrave; l'API Gateway qui le valide, puis les services internes valident aussi ce token.</p></li></ul></section><section class="chapter"><h2 id="introduction-qui-tes-vous-et-qu-avez-vous-le-droit-de-faire" data-toc="introduction-qui-tes-vous-et-qu-avez-vous-le-droit-de-faire">Introduction : Qui &ecirc;tes-vous et qu'avez-vous le droit de faire ?</h2><p id="-2b6p8k_21">Notre club &quot;GestBook&quot; est maintenant ouvert, avec une belle entr&eacute;e (<code class="code" id="-2b6p8k_25">API Gateway</code>) et des salles bien organis&eacute;es. Le probl&egrave;me ? N'importe qui peut entrer et faire n'importe quoi. Un client lambda pourrait aller dans l'arri&egrave;re-boutique (<code class="code" id="-2b6p8k_26">product-service</code>) et ajouter de nouveaux livres au catalogue, ou consulter les commandes des autres. C'est inacceptable.</p><p id="-2b6p8k_22">Nous avons besoin d'un service de s&eacute;curit&eacute; robuste. Ce service doit r&eacute;pondre &agrave; deux questions fondamentales pour chaque personne qui se pr&eacute;sente &agrave; l'entr&eacute;e :</p><ol class="list _decimal" id="-2b6p8k_23" type="1"><li class="list__item" id="-2b6p8k_27"><p id="-2b6p8k_29"><span class="control" id="-2b6p8k_30">Authentification : Qui &ecirc;tes-vous ?</span> (Prouvez votre identit&eacute;, montrez-moi votre carte d'identit&eacute;).</p></li><li class="list__item" id="-2b6p8k_28"><p id="-2b6p8k_31"><span class="control" id="-2b6p8k_32">Autorisation : Qu'avez-vous le droit de faire ?</span> (Votre carte d'identit&eacute; dit que vous &ecirc;tes un client, vous pouvez aller au bar, mais pas derri&egrave;re le comptoir. Si vous &ecirc;tes un employ&eacute;, vous avez plus de droits).</p></li></ol><p id="-2b6p8k_24">Dans le monde des APIs modernes, la solution &agrave; ce probl&egrave;me repose sur des standards ouverts comme <span class="control" id="-2b6p8k_33">OAuth2</span>, <span class="control" id="-2b6p8k_34">OpenID Connect (OIDC)</span> et les <span class="control" id="-2b6p8k_35">JSON Web Tokens (JWT)</span>. Nous allons utiliser un &quot;serveur d'autorisation&quot; externe, **Keycloak **, qui jouera le r&ocirc;le de l'agence de s&eacute;curit&eacute; qui d&eacute;livre les cartes d'identit&eacute; (les tokens).</p></section><section class="chapter"><h2 id="le-laissez-passer-json-web-token-jwt" data-toc="le-laissez-passer-json-web-token-jwt">Le Laissez-passer : JSON Web Token (JWT)</h2><p id="-2b6p8k_36">Dans une architecture stateless comme les microservices, on ne veut pas que chaque service ait &agrave; v&eacute;rifier un nom d'utilisateur et un mot de passe &agrave; chaque appel. La solution est un &quot;laissez-passer&quot; auto-contenu et s&eacute;curis&eacute; : le JWT.</p><aside class="prompt" data-type="tip" data-title="" id="-2b6p8k_37"><p id="-2b6p8k_44"><span class="control" id="-2b6p8k_45">D&eacute;finition :</span> Un <span class="control" id="-2b6p8k_46">JWT</span> est un standard (RFC 7519) qui d&eacute;finit un format compact et autonome pour transmettre de mani&egrave;re s&eacute;curis&eacute;e des informations (appel&eacute;es &quot;claims&quot;) entre des parties sous forme d'objet JSON.</p></aside><p id="-2b6p8k_38">Un JWT ressemble &agrave; une longue cha&icirc;ne de caract&egrave;res incompr&eacute;hensible, mais il est en r&eacute;alit&eacute; compos&eacute; de trois parties, s&eacute;par&eacute;es par des points : <code class="code" id="-2b6p8k_47">xxxxx.yyyyy.zzzzz</code></p><ol class="list _decimal" id="-2b6p8k_39" type="1"><li class="list__item" id="-2b6p8k_48"><p id="-2b6p8k_51"><span class="control" id="-2b6p8k_52">Header (En-t&ecirc;te) :</span> Contient des m&eacute;tadonn&eacute;es sur le token, comme l'algorithme de signature utilis&eacute; (<code class="code" id="-2b6p8k_53">alg</code>, ex: &quot; HS256&quot; ou &quot;RS256&quot;). Encod&eacute; en Base64Url.</p></li><li class="list__item" id="-2b6p8k_49"><p id="-2b6p8k_54"><span class="control" id="-2b6p8k_56">Payload (Charge utile) :</span> Contient les &quot;claims&quot;, les informations que l'on veut transmettre. Ce sont des paires cl&eacute;-valeur.</p><ul class="list _bullet" id="-2b6p8k_55"><li class="list__item" id="-2b6p8k_57"><p id="-2b6p8k_60"><span class="control" id="-2b6p8k_61">Claims enregistr&eacute;s :</span> <code class="code" id="-2b6p8k_62">iss</code> (issuer/&eacute;metteur), <code class="code" id="-2b6p8k_63">sub</code> (subject/sujet, souvent l'ID de l'utilisateur), <code class="code" id="-2b6p8k_64">exp</code> ( expiration time).</p></li><li class="list__item" id="-2b6p8k_58"><p id="-2b6p8k_65"><span class="control" id="-2b6p8k_66">Claims personnalis&eacute;s :</span> <code class="code" id="-2b6p8k_67">email</code>, <code class="code" id="-2b6p8k_68">given_name</code>, <code class="code" id="-2b6p8k_69">roles</code>, etc.</p></li><li class="list__item" id="-2b6p8k_59"><p id="-2b6p8k_70"><span class="control" id="-2b6p8k_71">C'est ici que l'on met les informations d'identit&eacute; et les autorisations de l'utilisateur !</span> Encod&eacute; en Base64Url.</p></li></ul></li><li class="list__item" id="-2b6p8k_50"><p id="-2b6p8k_72"><span class="control" id="-2b6p8k_73">Signature :</span> C'est la partie qui garantit l'authenticit&eacute; du token. Elle est calcul&eacute;e en signant le header et le payload avec une cl&eacute; secr&egrave;te (pour l'algorithme sym&eacute;trique HS256) ou une cl&eacute; priv&eacute;e (pour l'algorithme asym&eacute;trique RS256) connue uniquement du serveur d'autorisation.</p></li></ol><p id="-2b6p8k_40"><span class="control" id="-2b6p8k_74">Comment &ccedil;a marche ?</span> Le service qui re&ccedil;oit le JWT (ex: notre API Gateway) peut v&eacute;rifier la signature en utilisant la cl&eacute; publique correspondante.</p><ul class="list _bullet" id="-2b6p8k_41"><li class="list__item" id="-2b6p8k_75"><p id="-2b6p8k_77">Si la signature est valide, le service a la <span class="control" id="-2b6p8k_78">garantie</span> que le token n'a pas &eacute;t&eacute; modifi&eacute; et qu'il a bien &eacute;t&eacute; &eacute;mis par une source de confiance.</p></li><li class="list__item" id="-2b6p8k_76"><p id="-2b6p8k_79">Il peut alors faire confiance aux informations du Payload (comme le r&ocirc;le de l'utilisateur) pour prendre des d&eacute;cisions d'autorisation.</p></li></ul><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="62px" preserveAspectRatio="none" style="width:109px;height:62px;background:#FFFFFF;" version="1.1" viewBox="0 0 109 62" width="109px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="40.9766" rx="5" ry="5" style="stroke:#F1F1F1;stroke-width:1.5;" width="87" x="10" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="22" x="15" y="25.5352">alg</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="48" y="25.5352">RS256</text><line style="stroke:#000000;stroke-width:1.0;" x1="43" x2="43" y1="10" y2="30.4883"/><line style="stroke:#000000;stroke-width:1.0;" x1="10" x2="97" y1="30.4883" y2="30.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="23" x="15" y="46.0234">typ</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="48" y="46.0234">JWT</text><line style="stroke:#000000;stroke-width:1.0;" x1="43" x2="43" y1="30.4883" y2="50.9766"/><rect fill="none" height="40.9766" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="87" x="10" y="10"/><!--SRC=[HOxDQeD054RtzoakiqgW2T5gQ6SLyYFKHbBKfEkfJcI2kHDcha8eVVTgeMHxED_XMtbMZY_U4dm3eb1j8oIAl0ZZfNWQ2Tzl8qa_Im4_iD9K_zdmqIhYOxR7NZjlB64m3nVXypm89uapUAWOmmK6iOnUPHpXPbUKE0fJc6Hl9NhRkKfZRJmxyzNnK9X2gdg5UKTihbhYuQOftRx_0znHRvobgoQ6z9GzX6KqMnl6GhlX2vuosEgpwbeU5fMj3JKIZsKoUu6zegPJpT0-EzZOeUlk4fFy5m00]--></g></svg><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="134px" preserveAspectRatio="none" style="width:263px;height:134px;background:#FFFFFF;" version="1.1" viewBox="0 0 263 134" width="263px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="102.4414" rx="5" ry="5" style="stroke:#F1F1F1;stroke-width:1.5;" width="149" x="10" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="26" x="15" y="25.5352">sub</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="64" y="25.5352">1234567890</text><line style="stroke:#000000;stroke-width:1.0;" x1="59" x2="59" y1="10" y2="30.4883"/><line style="stroke:#000000;stroke-width:1.0;" x1="10" x2="159" y1="30.4883" y2="30.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="39" x="15" y="46.0234">name</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="64" y="46.0234">John Doe</text><line style="stroke:#000000;stroke-width:1.0;" x1="59" x2="59" y1="30.4883" y2="50.9766"/><line style="stroke:#000000;stroke-width:1.0;" x1="10" x2="159" y1="50.9766" y2="50.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="19" x="15" y="66.5117">iat</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="64" y="66.5117">1516239022</text><line style="stroke:#000000;stroke-width:1.0;" x1="59" x2="59" y1="50.9766" y2="71.4648"/><line style="stroke:#000000;stroke-width:1.0;" x1="10" x2="159" y1="71.4648" y2="71.4648"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="25" x="15" y="87">exp</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="64" y="87">1516242622</text><line style="stroke:#000000;stroke-width:1.0;" x1="59" x2="59" y1="71.4648" y2="91.9531"/><line style="stroke:#000000;stroke-width:1.0;" x1="10" x2="159" y1="91.9531" y2="91.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="36" x="15" y="107.4883">roles</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="12" x="64" y="107.4883">&#160;&#160;&#160;</text><line style="stroke:#000000;stroke-width:1.0;" x1="59" x2="59" y1="91.9531" y2="112.4414"/><rect fill="none" height="102.4414" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="149" x="10" y="10"/><rect fill="#F1F1F1" height="40.9766" rx="5" ry="5" style="stroke:#F1F1F1;stroke-width:1.5;" width="55" x="196" y="81.7207"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="201" y="97.2559">user</text><line style="stroke:#000000;stroke-width:1.0;" x1="196" x2="251" y1="102.209" y2="102.209"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="201" y="117.7441">reader</text><rect fill="none" height="40.9766" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="55" x="196" y="81.7207"/><path d="M147,102.2207 L160,102.2207 C169.314,102.2207 179.4025,102.2207 188.7197,102.2207 " fill="none" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:3.0,3.0;"/><path d="M188.7197,105.2651 L191.003,102.2207 L188.7197,99.1763 L196.3307,102.2207 L188.7197,105.2651 " fill="#000000" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="147" cy="102.2207" fill="#000000" rx="3" ry="3" style="stroke:#000000;stroke-width:1.0;"/><!--SRC=[HSvBQy9050NW_VoAowmKL999J3KhgGzeQh3usfGkHdErK-8TcOUqbFvt9xRItUNZtCCPMIUD-x2Qs3S3uDRlU0uy5adQpnu6muXt6YPvmiOB_KumqVYhIhg0SJ_EH3ACXBWXVfxlc8hi3uskqGP-vTwYuPqWAAjmlR4VDaAgRWlOIot9RSevND1OfGdYdeX4qej5QsOKBFOEH1IwytIOzrCOJrThQ09jrYgVrc2rDtk4IbbdrCwxqD1cXRn8M7foweGvBCv8nUJv3Z2bYpAQJaYE5TloFv2btKVbO8KcR85joIPuaBvsuMElAqN773RhMNV0vfAENXv3zy6miGwzvYk7sV8A]--></g></svg></div><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="322px" preserveAspectRatio="none" style="width:541px;height:322px;background:#FFFFFF;" version="1.1" viewBox="0 0 541 322" width="541px" zoomAndPan="magnify"><defs/><g><g id="elem_N1"><path d="M11,11 L11,68.3979 L341,68.3979 L341,21 L331,11 L11,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M331,11 L331,21 L341,21 L331,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="309" x="17" y="29.0698">Les trois parties (Header, Payload, Signature)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="294" x="17" y="44.8691">sont encod&#233;es en Base64Url et concat&#233;n&#233;es</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="278" x="17" y="60.6685">avec des points pour former le JWT final.</text></g><!--entity Header (Base64)--><g id="elem_Header (Base64)"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="158" x="376" y="16.19"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="514" y="21.19"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="512" y="23.19"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="512" y="27.19"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="391" y="50.2652">Header (Base64)</text></g><!--entity Payload (Base64)--><g id="elem_Payload (Base64)"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="161" x="374.5" y="145.4"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="515.5" y="150.4"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="513.5" y="152.4"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="513.5" y="156.4"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121" x="389.5" y="179.4752">Payload (Base64)</text></g><!--entity Signature--><g id="elem_Signature"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="109" x="400.5" y="269.42"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="489.5" y="274.42"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="487.5" y="276.42"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="487.5" y="280.42"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="415.5" y="303.4952">Signature</text></g><!--link Header (Base64) to Payload (Base64)--><g id="link_Header (Base64)_Payload (Base64)"><path d="M455,63.44 C455,86.45 455,115.84 455,138.93 " fill="none" id="Header (Base64)-to-Payload (Base64)" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="455,144.93,459,135.93,455,139.93,451,135.93,455,144.93" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="456" y="112.4698">&#160;</text></g><!--link Payload (Base64) to Signature--><g id="link_Payload (Base64)_Signature"><path d="M455,192.86 C455,214.67 455,241.3 455,263.08 " fill="none" id="Payload (Base64)-to-Signature" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="455,269.08,459,260.08,455,264.08,451,260.08,455,269.08" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="456" y="236.4898">&#160;</text></g><!--SRC=[ROx1IaD134NtynNNhbfe1K5Sk73XIagHGfKkYeiuazQ1USaZamf-Kh-ZFzPvl28kN8NSUnBEZNznn-WBPGd1jOShFjLTEwHi73rhAqITGHMlTm5OSOMRvegUp7FRfYzCYMsEDVqKfJJ79X-4_6WyQmTLnS4IDPrFZMR1CrL-k7-t0dP4bKX-FidGDfo-EI8riDSiFeoZOQ_MiQ4mbjitxBDGkGqi2ODQ2BlH0DFny-m3YxHumkugz2T_n6GI_ib7_jVx2eOB]--></g></svg></div></section><section class="chapter"><h2 id="l-agence-de-s-curit-oauth2-openid-connect-oidc" data-toc="l-agence-de-s-curit-oauth2-openid-connect-oidc">L'Agence de S&eacute;curit&eacute; : OAuth2 &amp; OpenID Connect (OIDC)</h2><p id="-2b6p8k_80">On ne cr&eacute;e pas les JWT nous-m&ecirc;mes. On d&eacute;l&egrave;gue cette t&acirc;che &agrave; un service sp&eacute;cialis&eacute; : un <span class="control" id="-2b6p8k_86">Serveur d'Autorisation</span>. Les protocoles <span class="control" id="-2b6p8k_87">OAuth2</span> et <span class="control" id="-2b6p8k_88">OIDC</span> d&eacute;finissent comment une application peut obtenir ces tokens de mani&egrave;re s&eacute;curis&eacute;e.</p><p id="-2b6p8k_81"><span class="control" id="-2b6p8k_89">Les R&ocirc;les Cl&eacute;s :</span></p><ul class="list _bullet" id="-2b6p8k_82"><li class="list__item" id="-2b6p8k_90"><p id="-2b6p8k_94"><span class="control" id="-2b6p8k_95">Resource Owner (Le Propri&eacute;taire de la Ressource) :</span> C'est l' <span class="control" id="-2b6p8k_96">utilisateur final</span>. C'est vous. Vous &ecirc;tes propri&eacute;taire de vos donn&eacute;es (votre profil, vos commandes).</p></li><li class="list__item" id="-2b6p8k_91"><p id="-2b6p8k_97"><span class="control" id="-2b6p8k_98">Client :</span> C'est l' <span class="control" id="-2b6p8k_99">application</span> qui veut acc&eacute;der aux ressources pour le compte de l'utilisateur (ex: une application mobile, un front-end React).</p></li><li class="list__item" id="-2b6p8k_92"><p id="-2b6p8k_100"><span class="control" id="-2b6p8k_101">Authorization Server (Le Serveur d'Autorisation) :</span> C'est le c&oelig;ur du syst&egrave;me. C'est lui qui <span class="control" id="-2b6p8k_102">authentifie</span> l'utilisateur (demande login/mdp) et qui, avec son consentement, d&eacute;livre des tokens au Client. <span class="control" id="-2b6p8k_103">Keycloak</span> jouera ce r&ocirc;le.</p></li><li class="list__item" id="-2b6p8k_93"><p id="-2b6p8k_104"><span class="control" id="-2b6p8k_105">Resource Server (Le Serveur de Ressources) :</span> C'est l' <span class="control" id="-2b6p8k_106">API</span> qui prot&egrave;ge les ressources (nos microservices : <code class="code" id="-2b6p8k_107">product-service</code>, <code class="code" id="-2b6p8k_108">order-service</code>). Il demande un token valide pour donner l'acc&egrave;s.</p></li></ul><p id="-2b6p8k_83"><span class="control" id="-2b6p8k_109">Quelle est la diff&eacute;rence entre OAuth2 et OIDC ?</span></p><ul class="list _bullet" id="-2b6p8k_84"><li class="list__item" id="-2b6p8k_110"><p id="-2b6p8k_112"><span class="control" id="-2b6p8k_113">OAuth2 est un framework d'AUTORISATION.</span> Son but est de permettre &agrave; un Client d'acc&eacute;der &agrave; des ressources pour un utilisateur. Il d&eacute;finit comment obtenir un <span class="control" id="-2b6p8k_114">Access Token</span>. Cet access token dit ce que l'application a le droit de <span class="emphasis" id="-2b6p8k_115">faire</span>.</p></li><li class="list__item" id="-2b6p8k_111"><p id="-2b6p8k_116"><span class="control" id="-2b6p8k_117">OpenID Connect (OIDC) est une surcouche d'AUTHENTIFICATION au-dessus d'OAuth2.</span> Son but est de v&eacute;rifier l'identit&eacute; de l'utilisateur. Il ajoute le concept d' <span class="control" id="-2b6p8k_118">ID Token</span> (qui est un JWT) et un endpoint (<code class="code" id="-2b6p8k_119">/userinfo</code>) pour obtenir des informations sur l'utilisateur.</p></li></ul><p id="-2b6p8k_85">En r&eacute;sum&eacute; : <span class="control" id="-2b6p8k_120">OIDC = Authentification (Qui &ecirc;tes-vous ?)</span>, <span class="control" id="-2b6p8k_121">OAuth2 = Autorisation (Que pouvez-vous faire ?)</span>.</p></section><section class="chapter"><h2 id="le-flux-de-s-curisation-dans-notre-architecture" data-toc="le-flux-de-s-curisation-dans-notre-architecture">Le Flux de S&eacute;curisation dans notre Architecture</h2><p id="-2b6p8k_122">Voici comment nous allons s&eacute;curiser notre application. C'est un flux tr&egrave;s standard.</p><ol class="list _decimal" id="-2b6p8k_123" type="1"><li class="list__item" id="-2b6p8k_125"><p id="-2b6p8k_131"><span class="control" id="-2b6p8k_132">L'utilisateur veut se connecter :</span> Notre application front-end (que nous n'avons pas, mais que nous simulons avec Postman) redirige l'utilisateur vers la page de connexion de <span class="control" id="-2b6p8k_133">Keycloak</span>.</p></li><li class="list__item" id="-2b6p8k_126"><p id="-2b6p8k_134"><span class="control" id="-2b6p8k_135">Authentification :</span> L'utilisateur saisit son nom d'utilisateur et son mot de passe <span class="control" id="-2b6p8k_136">sur le site de Keycloak</span>. Nos services ne voient JAMAIS ces identifiants.</p></li><li class="list__item" id="-2b6p8k_127"><p id="-2b6p8k_137"><span class="control" id="-2b6p8k_138">Obtention du Token :</span> Si l'authentification r&eacute;ussit, Keycloak renvoie un <span class="control" id="-2b6p8k_139">Access Token</span> (un JWT) au front-end.</p></li><li class="list__item" id="-2b6p8k_128"><p id="-2b6p8k_140"><span class="control" id="-2b6p8k_141">Appel de l'API :</span> Le front-end effectue maintenant ses appels &agrave; notre API en incluant ce token dans l'en-t&ecirc;te <code class="code" id="-2b6p8k_142">Authorization</code> (ex: <code class="code" id="-2b6p8k_143">Authorization: Bearer xxxxx.yyyyy.zzzzz</code>).</p></li><li class="list__item" id="-2b6p8k_129"><p id="-2b6p8k_144"><span class="control" id="-2b6p8k_146">Validation par l'API Gateway :</span></p><ul class="list _bullet" id="-2b6p8k_145"><li class="list__item" id="-2b6p8k_147"><p id="-2b6p8k_150">L' <span class="control" id="-2b6p8k_151">API Gateway</span> re&ccedil;oit la requ&ecirc;te. Elle est configur&eacute;e comme un &quot;Resource Server&quot;.</p></li><li class="list__item" id="-2b6p8k_148"><p id="-2b6p8k_152">Elle voit le token, contacte Keycloak (ou utilise sa cl&eacute; publique mise en cache) pour <span class="control" id="-2b6p8k_153">valider la signature du JWT</span>.</p></li><li class="list__item" id="-2b6p8k_149"><p id="-2b6p8k_154">Si le token est valide et non expir&eacute;, la Gateway peut prendre une premi&egrave;re d&eacute;cision de routage ou de filtrage.</p></li></ul></li><li class="list__item" id="-2b6p8k_130"><p id="-2b6p8k_155"><span class="control" id="-2b6p8k_157">Transmission et validation par les services internes :</span></p><ul class="list _bullet" id="-2b6p8k_156"><li class="list__item" id="-2b6p8k_158"><p id="-2b6p8k_161">La Gateway transmet la requ&ecirc;te (avec le token) au service interne concern&eacute; (ex: <code class="code" id="-2b6p8k_162">product-service</code>).</p></li><li class="list__item" id="-2b6p8k_159"><p id="-2b6p8k_163">Le <code class="code" id="-2b6p8k_164">product-service</code> est lui aussi configur&eacute; comme &quot;Resource Server&quot;. Il <span class="control" id="-2b6p8k_165">re-valide le token</span> pour s'assurer qu' il n'a pas &eacute;t&eacute; falsifi&eacute; en cours de route.</p></li><li class="list__item" id="-2b6p8k_160"><p id="-2b6p8k_166">Il peut alors utiliser les informations du token (ex: les <code class="code" id="-2b6p8k_167">roles</code>) pour appliquer une logique d'autorisation fine. Par exemple : &quot;Cette requ&ecirc;te <code class="code" id="-2b6p8k_168">POST /api/products</code> est-elle autoris&eacute;e ? Oui, si le token contient le r&ocirc;le <code class="code" id="-2b6p8k_169">ROLE_ADMIN</code> .&quot;</p></li></ul></li></ol><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="626px" preserveAspectRatio="none" style="width:1119px;height:626px;background:#FFFFFF;" version="1.1" viewBox="0 0 1119 626" width="1119px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="498" x="315" y="37.1182">Flux d'authentification et d'autorisation</text><rect fill="#FFFFFF" height="229.3945" style="stroke:#000000;stroke-width:1.0;" width="10" x="676" y="297.5479"/><rect fill="#FFFFFF" height="88.3979" style="stroke:#000000;stroke-width:1.0;" width="10" x="859" y="408.7451"/><line style="stroke:#000000;stroke-width:1.0;" x1="49" x2="49" y1="130.752" y2="544.9424"/><line style="stroke:#000000;stroke-width:1.0;" x1="210" x2="210" y1="130.752" y2="544.9424"/><line style="stroke:#000000;stroke-width:1.0;" x1="455.5" x2="455.5" y1="130.752" y2="544.9424"/><line style="stroke:#000000;stroke-width:1.0;" x1="681" x2="681" y1="130.752" y2="544.9424"/><line style="stroke:#000000;stroke-width:1.0;" x1="864" x2="864" y1="130.752" y2="544.9424"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="10" y="127.8125">Utilisateur</text><ellipse cx="49" cy="61.7373" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1.0;"/><path d="M49,69.7373 L49,96.7373 M36,77.7373 L62,77.7373 M49,96.7373 L36,111.7373 M49,96.7373 L62,111.7373 " fill="none" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="10" y="558.0176">Utilisateur</text><ellipse cx="49" cy="569.957" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1.0;"/><path d="M49,577.957 L49,604.957 M36,585.957 L62,585.957 M49,604.957 L36,619.957 M49,604.957 L62,619.957 " fill="none" style="stroke:#000000;stroke-width:1.0;"/><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="162" x="129" y="81.7227"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="124" x="148" y="102.7979">Application Client</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="148" x="136" y="119.8125">(ex: React, Postman)</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="162" x="129" y="543.9424"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="124" x="148" y="565.0176">Application Client</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="148" x="136" y="582.0322">(ex: React, Postman)</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="171" x="370.5" y="81.7227"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="61" x="425.5" y="102.7979">Keycloak</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="157" x="377.5" y="119.8125">(Authorization Server)</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="171" x="370.5" y="543.9424"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="61" x="425.5" y="565.0176">Keycloak</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="157" x="377.5" y="582.0322">(Authorization Server)</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="140" x="611" y="81.7227"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="89" x="636.5" y="102.7979">API Gateway</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="126" x="618" y="119.8125">(Resource Server)</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="140" x="611" y="543.9424"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="89" x="636.5" y="565.0176">API Gateway</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="126" x="618" y="582.0322">(Resource Server)</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="140" x="794" y="81.7227"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="809.5" y="102.7979">Product Service</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="126" x="801" y="119.8125">(Resource Server)</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="140" x="794" y="543.9424"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="809.5" y="565.0176">Product Service</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="126" x="801" y="582.0322">(Resource Server)</text><rect fill="#FFFFFF" height="229.3945" style="stroke:#000000;stroke-width:1.0;" width="10" x="676" y="297.5479"/><rect fill="#FFFFFF" height="88.3979" style="stroke:#000000;stroke-width:1.0;" width="10" x="859" y="408.7451"/><polygon fill="#000000" points="198,158.5513,208,162.5513,198,166.5513,202,162.5513" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="49" x2="204" y1="162.5513" y2="162.5513"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="137" x="56" y="157.8218">1. Clique sur "Login"</text><polygon fill="#000000" points="444,188.3506,454,192.3506,444,196.3506,448,192.3506" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="210" x2="450" y1="192.3506" y2="192.3506"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222" x="217" y="187.6211">2. Redirection vers page de login</text><polygon fill="#000000" points="444,218.1499,454,222.1499,444,226.1499,448,222.1499" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="49" x2="450" y1="222.1499" y2="222.1499"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="127" x="56" y="217.4204">3. Saisit login/mdp</text><polygon fill="#000000" points="221,247.9492,211,251.9492,221,255.9492,217,251.9492" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="215" x2="455" y1="251.9492" y2="251.9492"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="217" x="227" y="247.2197">4. Renvoie l'Access Token (JWT)</text><polygon fill="#000000" points="664,293.5479,674,297.5479,664,301.5479,668,297.5479" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="210" x2="670" y1="297.5479" y2="297.5479"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="147" x="217" y="277.019">5. POST /api/products</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="257" x="217" y="292.8184">Header: Authorization: Bearer &lt;JWT&gt;</text><polygon fill="#000000" points="467,326.3472,457,330.3472,467,334.3472,463,330.3472" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="461" x2="675" y1="330.3472" y2="330.3472"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196" x="473" y="325.6177">6. Valide la signature du JWT</text><path d="M691,310.5479 L691,335.5479 L804,335.5479 L804,320.5479 L794,310.5479 L691,310.5479 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M794,310.5479 L794,320.5479 L804,320.5479 L794,310.5479 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="92" x="697" y="328.6177">Via JWKS URI</text><polygon fill="#000000" points="664,359.1465,674,363.1465,664,367.1465,668,363.1465" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="456" x2="670" y1="363.1465" y2="363.1465"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="88" x="463" y="358.417">Signature OK</text><polygon fill="#000000" points="847,404.7451,857,408.7451,847,412.7451,851,408.7451" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="686" x2="853" y1="408.7451" y2="408.7451"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="154" x="693" y="388.2163">7. Transmet la requ&#234;te</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="80" x="693" y="404.0156">avec le JWT</text><line style="stroke:#000000;stroke-width:1.0;" x1="869" x2="911" y1="454.3438" y2="454.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="911" x2="911" y1="454.3438" y2="467.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="870" x2="911" y1="467.3438" y2="467.3438"/><polygon fill="#000000" points="880,463.3438,870,467.3438,880,471.3438,876,467.3438" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="126" x="876" y="433.8149">8. Valide le JWT et</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="236" x="876" y="449.6143">v&#233;rifie les r&#244;les (ex: ROLE_ADMIN)</text><polygon fill="#000000" points="697,493.1431,687,497.1431,697,501.1431,693,497.1431" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="691" x2="863" y1="497.1431" y2="497.1431"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="99" x="703" y="492.4136">9. 201 Created</text><polygon fill="#000000" points="221,522.9424,211,526.9424,221,530.9424,217,526.9424" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="215" x2="680" y1="526.9424" y2="526.9424"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="107" x="227" y="522.2129">10. 201 Created</text><!--SRC=[TLBRRjD047ttLmnvQICLfosKYuKgXG8Xf10hJkgNI6Yq7j9HdRMxkmujVmJF_45-Z5axTXkaFbcUEUVCERFpp5tJcg3CaNNWsEK4lKzvTGVP0LRIquv_i4B7XGPoJRKmREjABmXGoI_q5evpNwJAz00jB2oPe4JZM769sa5lM9PvAtIHimWlzI7THJ0ZqJY2kB1kZRfVqmMypvxGlSeBl17EK6o9Wr-DL49cGwPXjQ3_1iTZ68cpdtWlx1dPeZAAzeYZT9yIcoAhbAinhEWfMfm4WGyApy-zumXEGX_jjYAmbIpbibYnx4XQ7j6wY-0qbD0P6r9r1D6pKEAA82F8FQTJVU2y2251jkmQn62TbK7RxUQ_zC9wKx3e70oL8cjXNjoGXiClwRmVj5P6QGHd8SJJP0u3B7bGDe7jKdycpCX4iBVb2DuJ6h7qJcJE_PlpHZRgzpPAzts-2k4AS_P942olDBhAIB8AX1heGbY6LzSkWYj6gKqIMCp6ZwBix2KTTJhP3OcJ25w7C3UexLfkKGOOkgssVvoy46v8WHoldzBvamUAavRwvi5P3PDpNkhDzhUH0_Sr2sRxrt-QgvnUVlm-_F1r_ArVQ-nilGtXzFW4BWo9VXPaz7YMjzcTml6Jo57w3m00]--></g></svg></div></section><section class="chapter"><h2 id="notre-bo-te-outils" data-toc="notre-bo-te-outils">Notre Bo&icirc;te &agrave; Outils</h2><p id="-2b6p8k_170">Pour impl&eacute;menter tout cela, nous allons utiliser :</p><ul class="list _bullet" id="-2b6p8k_171"><li class="list__item" id="-2b6p8k_173"><p id="-2b6p8k_176"><span class="control" id="-2b6p8k_177">Keycloak :</span> Notre serveur d'autorisation, que nous lancerons dans Docker.</p></li><li class="list__item" id="-2b6p8k_174"><p id="-2b6p8k_178"><span class="control" id="-2b6p8k_179"><code class="code" id="-2b6p8k_181">spring-boot-starter-oauth2-resource-server</code>:</span> Une d&eacute;pendance Spring Boot qui transforme magiquement un service en &quot;Resource Server&quot;. Il suffit de lui indiquer dans <code class="code" id="-2b6p8k_180">application.properties</code> l'adresse de notre serveur Keycloak, et il saura automatiquement comment valider les JWT entrants.</p></li><li class="list__item" id="-2b6p8k_175"><p id="-2b6p8k_182"><span class="control" id="-2b6p8k_183">Spring Security :</span> Pour configurer les r&egrave;gles d'autorisation fines sur nos endpoints (ex: <code class="code" id="-2b6p8k_184">http.authorizeHttpRequests(auth -&gt; auth.requestMatchers(HttpMethod.POST, &quot;/api/products&quot;).hasRole(&quot;ADMIN&quot;))</code>).</p></li></ul></section><section class="chapter"><h2 id="conclusion-de-la-partie" data-toc="conclusion-de-la-partie">Conclusion de la partie</h2><p id="-2b6p8k_185">La s&eacute;curit&eacute; n'est plus une bo&icirc;te noire. Vous comprenez maintenant la &quot;danse&quot; &agrave; trois entre l'utilisateur, le client et le serveur d'autorisation, orchestr&eacute;e par les protocoles <span class="control" id="-2b6p8k_190">OAuth2/OIDC</span>. Vous savez que le <span class="control" id="-2b6p8k_191">JWT</span> est le laissez-passer qui contient l'identit&eacute; et les droits de l'utilisateur de mani&egrave;re s&eacute;curis&eacute;e et v&eacute;rifiable.</p><p id="-2b6p8k_186">Vous avez une vision claire du flux que nous allons mettre en place :</p><ol class="list _decimal" id="-2b6p8k_187" type="1"><li class="list__item" id="-2b6p8k_192"><p id="-2b6p8k_195"><span class="control" id="-2b6p8k_196">Keycloak</span> &eacute;met les tokens.</p></li><li class="list__item" id="-2b6p8k_193"><p id="-2b6p8k_197">L' <span class="control" id="-2b6p8k_198">API Gateway</span> agit comme premier rempart, validant chaque token entrant.</p></li><li class="list__item" id="-2b6p8k_194"><p id="-2b6p8k_199">Les <span class="control" id="-2b6p8k_200">microservices internes</span> agissent comme second rempart, re-validant le token et appliquant des r&egrave;gles d'autorisation pr&eacute;cises.</p></li></ol><p id="-2b6p8k_188">Dans le TP qui suit, nous allons mettre tout cela en pratique : ajouter Keycloak &agrave; notre <code class="code" id="-2b6p8k_201">docker-compose.yml</code>, le configurer, et transformer notre <code class="code" id="-2b6p8k_202">product-service</code> en un &quot;Resource Server&quot; capable de prot&eacute;ger ses endpoints.</p></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><ol class="list _decimal" id="-2b6p8k_203" type="1"><li class="list__item" id="-2b6p8k_204"><p id="-2b6p8k_209"><span class="control" id="-2b6p8k_210">(Question ouverte)</span> Quelle est la diff&eacute;rence fondamentale entre l'authentification et l'autorisation ?</p></li><li class="list__item" id="-2b6p8k_205"><p id="-2b6p8k_211"><span class="control" id="-2b6p8k_213">(QCM)</span> Quelle partie d'un JWT garantit qu'il n'a pas &eacute;t&eacute; alt&eacute;r&eacute; ?</p><ul class="list _bullet" id="-2b6p8k_212"><li class="list__item" id="-2b6p8k_214"><p id="-2b6p8k_218">A) Le Header</p></li><li class="list__item" id="-2b6p8k_215"><p id="-2b6p8k_219">B) Le Payload</p></li><li class="list__item" id="-2b6p8k_216"><p id="-2b6p8k_220">C) La Signature</p></li><li class="list__item" id="-2b6p8k_217"><p id="-2b6p8k_221">D) L'encodage Base64</p></li></ul></li><li class="list__item" id="-2b6p8k_206"><p id="-2b6p8k_222"><span class="control" id="-2b6p8k_224">(QCM)</span> Dans l'&eacute;cosyst&egrave;me OAuth2, quel est le r&ocirc;le de Keycloak ?</p><ul class="list _bullet" id="-2b6p8k_223"><li class="list__item" id="-2b6p8k_225"><p id="-2b6p8k_229">A) Client</p></li><li class="list__item" id="-2b6p8k_226"><p id="-2b6p8k_230">B) Resource Owner</p></li><li class="list__item" id="-2b6p8k_227"><p id="-2b6p8k_231">C) Resource Server</p></li><li class="list__item" id="-2b6p8k_228"><p id="-2b6p8k_232">D) Authorization Server</p></li></ul></li><li class="list__item" id="-2b6p8k_207"><p id="-2b6p8k_233"><span class="control" id="-2b6p8k_234">(Question ouverte)</span> Pourquoi est-il important que l'API Gateway ET les microservices internes valident tous les deux le JWT ?</p></li><li class="list__item" id="-2b6p8k_208"><p id="-2b6p8k_235"><span class="control" id="-2b6p8k_237">(QCM)</span> Une application front-end a besoin de conna&icirc;tre le nom et l'email de l'utilisateur connect&eacute; pour afficher &quot; Bonjour, John Doe&quot;. Quel standard est sp&eacute;cifiquement con&ccedil;u pour ce besoin d'identit&eacute; ?</p><ul class="list _bullet" id="-2b6p8k_236"><li class="list__item" id="-2b6p8k_238"><p id="-2b6p8k_242">A) OAuth 2.0</p></li><li class="list__item" id="-2b6p8k_239"><p id="-2b6p8k_243">B) JWT</p></li><li class="list__item" id="-2b6p8k_240"><p id="-2b6p8k_244">C) OpenID Connect (OIDC)</p></li><li class="list__item" id="-2b6p8k_241"><p id="-2b6p8k_245">D) SAML</p></li></ul></li></ol></section><div class="last-modified">17 juillet 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="008-01-tp-8.html" class="navigation-links__prev">... autres services</a><a href="009-01-tp-9.html" class="navigation-links__next">TP 9 : &quot;Montrez patte blanche&quot; - S&eacute;curisation de l'API avec Keycloak et Spring Security</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>