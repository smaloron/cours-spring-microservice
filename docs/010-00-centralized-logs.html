<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-27T21:24:57.010484"><title>Module 10 : Logs Centralis&eacute;s (Pattern EFK) - Voir clair dans le brouillard | Spring Micro Services</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs Pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction-la-recherche-de-l-aiguille-dans-une-botte-de-foin","level":0,"title":"Introduction : La recherche de l\u0027aiguille dans une botte de foin","anchor":"#introduction-la-recherche-de-l-aiguille-dans-une-botte-de-foin"},{"id":"la-stack-efk-notre-centre-de-tri-du-courrier","level":0,"title":"La Stack EFK : Notre Centre de Tri du Courrier","anchor":"#la-stack-efk-notre-centre-de-tri-du-courrier"},{"id":"l-importance-des-logs-structur-s-json","level":0,"title":"L\u0027importance des Logs Structurés (JSON)","anchor":"#l-importance-des-logs-structur-s-json"},{"id":"l-id-de-corr-lation-suivre-une-requ-te-de-bout-en-bout","level":0,"title":"L\u0027ID de Corrélation : Suivre une Requête de bout en bout","anchor":"#l-id-de-corr-lation-suivre-une-requ-te-de-bout-en-bout"},{"id":"conclusion-de-la-partie","level":0,"title":"Conclusion de la partie","anchor":"#conclusion-de-la-partie"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 10 : Logs Centralis&eacute;s (Pattern EFK) - Voir clair dans le brouillard | Spring Micro Services"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Spring Micro Services Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/010-00-centralized-logs.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 10 : Logs Centralis&eacute;s (Pattern EFK) - Voir clair dans le brouillard | Spring Micro Services"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/010-00-centralized-logs.html#webpage",
    "url": "writerside-documentation/010-00-centralized-logs.html",
    "name": "Module 10 : Logs Centralis&eacute;s (Pattern EFK) - Voir clair dans le brouillard | Spring Micro Services",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Spring Micro Services Help"
}</script><!-- End Schema.org --></head><body data-id="010-00-centralized-logs" data-main-title="Module 10 : Logs Centralisés (Pattern EFK) - Voir clair dans le brouillard" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Spring Micro Services  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="010-00-centralized-logs" id="010-00-centralized-logs.md">Module 10 : Logs Centralisés (Pattern EFK) - Voir clair dans le brouillard</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs P&eacute;dagogiques</h2><p id="-s4cx0x_10">&Agrave; la fin de ce module, vous serez capable de :</p><ul class="list _bullet" id="-s4cx0x_11"><li class="list__item" id="-s4cx0x_12"><p id="-s4cx0x_17">Comprendre la n&eacute;cessit&eacute; de centraliser les logs dans une architecture distribu&eacute;e.</p></li><li class="list__item" id="-s4cx0x_13"><p id="-s4cx0x_18">D&eacute;crire le r&ocirc;le de chaque composant de la stack EFK (Elasticsearch, Fluentd, Kibana).</p></li><li class="list__item" id="-s4cx0x_14"><p id="-s4cx0x_19">Configurer un microservice Spring Boot pour produire des logs structur&eacute;s au format JSON.</p></li><li class="list__item" id="-s4cx0x_15"><p id="-s4cx0x_20">Exploiter l'interface de Kibana pour rechercher et filtrer les logs de mani&egrave;re efficace.</p></li><li class="list__item" id="-s4cx0x_16"><p id="-s4cx0x_21">Appr&eacute;cier l'importance des ID de corr&eacute;lation pour suivre une requ&ecirc;te &agrave; travers plusieurs services.</p></li></ul></section><section class="chapter"><h2 id="introduction-la-recherche-de-l-aiguille-dans-une-botte-de-foin" data-toc="introduction-la-recherche-de-l-aiguille-dans-une-botte-de-foin">Introduction : La recherche de l'aiguille dans une botte de foin</h2><p id="-s4cx0x_22">Imaginez un instant que notre application &quot;GestBook&quot; est en production. Un utilisateur vous appelle, furieux : &quot;J'ai essay&eacute; de passer une commande il y a 5 minutes, et j'ai eu une erreur obscure !&quot;.</p><p id="-s4cx0x_23">Dans notre architecture, cette simple requ&ecirc;te a potentiellement travers&eacute; :</p><ol class="list _decimal" id="-s4cx0x_24" type="1"><li class="list__item" id="-s4cx0x_28"><p id="-s4cx0x_31">L' <span class="control" id="-s4cx0x_32">API Gateway</span></p></li><li class="list__item" id="-s4cx0x_29"><p id="-s4cx0x_33">L' <span class="control" id="-s4cx0x_34">Order Service</span></p></li><li class="list__item" id="-s4cx0x_30"><p id="-s4cx0x_35">Le <span class="control" id="-s4cx0x_36">Product Service</span></p></li></ol><p id="-s4cx0x_25">Pour comprendre ce qui s'est pass&eacute;, vous devriez :</p><ol class="list _decimal" id="-s4cx0x_26" type="1"><li class="list__item" id="-s4cx0x_37"><p id="-s4cx0x_40">Vous connecter au serveur (ou conteneur) de l'API Gateway et fouiller dans ses fichiers de logs.</p></li><li class="list__item" id="-s4cx0x_38"><p id="-s4cx0x_41">Faire de m&ecirc;me pour le serveur de l'Order Service.</p></li><li class="list__item" id="-s4cx0x_39"><p id="-s4cx0x_42">Et encore pour le Product Service.</p></li></ol><p id="-s4cx0x_27">C'est une t&acirc;che titanesque, lente et inefficace. C'est comme chercher une aiguille, non pas dans une botte de foin, mais dans trois bottes de foin diff&eacute;rentes, sans savoir dans laquelle elle se trouve. C'est ici qu'intervient la <span class="control" id="-s4cx0x_43">centralisation des logs</span>. L'id&eacute;e est simple : tous les services envoient leurs logs vers un seul et m&ecirc;me endroit, o&ugrave; ils peuvent &ecirc;tre stock&eacute;s, index&eacute;s et interrog&eacute;s facilement.</p></section><section class="chapter"><h2 id="la-stack-efk-notre-centre-de-tri-du-courrier" data-toc="la-stack-efk-notre-centre-de-tri-du-courrier">La Stack EFK : Notre Centre de Tri du Courrier</h2><p id="-s4cx0x_44">Pour mettre en place cette centralisation, nous allons utiliser une stack tr&egrave;s populaire : <span class="control" id="-s4cx0x_47">EFK</span>.</p><ul class="list _bullet" id="-s4cx0x_45"><li class="list__item" id="-s4cx0x_48"><p id="-s4cx0x_51"><span class="control" id="-s4cx0x_52">E - Elasticsearch :</span> C'est la base de donn&eacute;es de notre syst&egrave;me. Mais ce n'est pas une base de donn&eacute;es relationnelle. C'est un moteur de recherche et d'analyse extr&ecirc;mement puissant, optimis&eacute; pour stocker, indexer et rechercher d'&eacute;normes volumes de donn&eacute;es textuelles (comme nos logs) &agrave; une vitesse fulgurante. C'est notre entrep&ocirc;t de &quot;bottes de foin&quot;.</p></li><li class="list__item" id="-s4cx0x_49"><p id="-s4cx0x_53"><span class="control" id="-s4cx0x_54">F - Fluentd :</span> C'est le collecteur de logs. C'est l'agent &quot;postier&quot; qui tourne sur nos serveurs (ou en tant que service). Son r&ocirc;le est de r&eacute;cup&eacute;rer les logs de diff&eacute;rentes sources (fichiers, sorties de conteneurs Docker, etc.), de les transformer si besoin (ex: ajouter des m&eacute;tadonn&eacute;es), et de les acheminer de mani&egrave;re fiable vers une destination, en l'occurrence Elasticsearch. Il est l&eacute;ger et tr&egrave;s configurable. C'est une alternative populaire &agrave; Logstash (qui donne la stack ELK).</p></li><li class="list__item" id="-s4cx0x_50"><p id="-s4cx0x_55"><span class="control" id="-s4cx0x_56">K - Kibana :</span> C'est l'interface de visualisation. C'est la magnifique salle de tri avec des outils de recherche, des loupes et des filtres. Kibana est une application web qui se connecte &agrave; Elasticsearch et nous permet d'explorer nos logs, de cr&eacute;er des tableaux de bord, des graphiques et des alertes. C'est notre principal outil d'investigation.</p></li></ul><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="465px" preserveAspectRatio="none" style="width:922px;height:465px;background:#FFFFFF;" version="1.1" viewBox="0 0 922 465" width="922px" zoomAndPan="magnify"><defs/><g><!--cluster Nos Microservices--><g id="cluster_Nos Microservices"><path d="M339.5,11 L481.5,11 A3.75,3.75 0 0 1 484,13.5 L491,34.0146 L868.5,34.0146 A2.5,2.5 0 0 1 871,36.5146 L871,227.51 A2.5,2.5 0 0 1 868.5,230.01 L339.5,230.01 A2.5,2.5 0 0 1 337,227.51 L337,13.5 A2.5,2.5 0 0 1 339.5,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="337" x2="491" y1="34.0146" y2="34.0146"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="141" x="341" y="27.0752">Nos Microservices</text></g><!--cluster GW--><g id="cluster_GW"><rect fill="#FFFFFF" height="135.01" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="181" x="658" y="63"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="101" x="698" y="79.0752">API Gateway</text></g><!--entity Logs JSON--><g id="elem_Logs JSON"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="114" x="682" y="127"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="776" y="132"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="774" y="134"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="774" y="138"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="74" x="697" y="161.0752">Logs JSON</text></g><!--entity PS--><g id="elem_PS"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="129" x="353.5" y="132"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="363.5" y="156.0752">Product Service</text></g><!--entity OS--><g id="elem_OS"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="116" x="518" y="132"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="96" x="528" y="156.0752">Order Service</text></g><!--entity Fluentd--><g id="elem_Fluentd"><rect fill="#FFFFFF" height="54.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="102" x="476" y="297.51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="53" x="486" y="321.5852">Fluentd</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82" x="486" y="338.5998">(Collecteur)</text></g><!--entity ES--><g id="elem_ES"><path d="M714.5,303.01 C714.5,293.01 810,293.01 810,293.01 C810,293.01 905.5,293.01 905.5,303.01 L905.5,346.0393 C905.5,356.0393 810,356.0393 810,356.0393 C810,356.0393 714.5,356.0393 714.5,346.0393 L714.5,303.01 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M714.5,303.01 C714.5,313.01 810,313.01 810,313.01 C810,313.01 905.5,313.01 905.5,303.01 " fill="none" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="90" x="724.5" y="331.0852">Elasticsearch</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="171" x="724.5" y="348.0998">(Stockage &amp; Indexation)</text></g><!--entity Web Browser--><g id="elem_Web Browser"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="132" x="12" y="127"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="124" y="132"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="122" y="134"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="122" y="138"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="92" x="27" y="161.0752">Web Browser</text></g><!--entity Kibana\n(Visualisation)--><g id="elem_Kibana\n(Visualisation)"><rect fill="#FFFFFF" height="64.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="140" x="179" y="118.49"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="299" y="123.49"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="297" y="125.49"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="297" y="129.49"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="48" x="194" y="152.5652">Kibana</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="100" x="194" y="169.5798">(Visualisation)</text></g><!--entity Kibana--><g id="elem_Kibana"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="88" x="353" y="301.02"/><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="421" y="306.02"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="419" y="308.02"/><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="419" y="312.02"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="48" x="368" y="335.0952">Kibana</text></g><g id="elem_N1"><path d="M418.5,417.04 L418.5,458.6386 A0,0 0 0 0 418.5,458.6386 L635.5,458.6386 A0,0 0 0 0 635.5,458.6386 L635.5,427.04 L625.5,417.04 L531,417.04 L527,351.91 L523,417.04 L418.5,417.04 A0,0 0 0 0 418.5,417.04 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M625.5,417.04 L625.5,427.04 L635.5,427.04 L625.5,417.04 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193" x="424.5" y="435.1098">Fluentd collecte tous les logs</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196" x="424.5" y="450.9091">et les envoie &#224; Elasticsearch.</text></g><!--link Web Browser to Kibana\n(Visualisation)--><g id="link_Web Browser_Kibana\n(Visualisation)"><path d="M144.46,150.5 C155.9,150.5 161.33,150.5 172.76,150.5 " fill="none" id="Web Browser-to-Kibana\n(Visualisation)" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="178.76,150.5,169.76,146.5,173.76,150.5,169.76,154.5,178.76,150.5" style="stroke:#000000;stroke-width:1.0;"/></g><!--link Kibana to ES--><g id="link_Kibana_ES"><path d="M405.67,300.81 C412.65,285.49 424.12,266.78 441,257.68 C469.95,242.08 556.47,252.87 589,257.68 C635,264.49 679.0038,276.935 719.5938,290.605 " fill="none" id="Kibana-to-ES" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="725.28,292.52,718.0274,285.8567,720.5415,290.9242,715.474,293.4383,725.28,292.52" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="146" x="442" y="260.0798">Interroge les donn&#233;es</text></g><!--link GW to Fluentd--><g id="link_GW_Fluentd"><path d="M829.688,198.4328 C829.6352,198.7229 829.5814,199.0131 829.5264,199.3035 C828.6476,203.9496 827.4877,208.634 825.9716,213.2033 C822.9394,222.3419 818.4825,231.02 812,238.01 C780.3,272.2 659.4807,299.2038 586.3307,313.0338 " fill="none" id="GW-to-Fluentd" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="578.47,314.52,586.8881,315.9816,585.7734,310.086,578.47,314.52" style="stroke:#000000;stroke-width:1.0;"/></g><!--link PS to Fluentd--><g id="link_PS_Fluentd"><path d="M417.54,169.25 C417.76,192.61 421.11,234.11 440,263.01 C448.96,276.72 455.5847,283.7114 469.0547,292.8714 " fill="none" id="PS-to-Fluentd" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="475.67,297.37,470.7417,290.3906,467.3677,295.3521,475.67,297.37" style="stroke:#000000;stroke-width:1.0;"/></g><!--link OS to Fluentd--><g id="link_OS_Fluentd"><path d="M583.63,169.28 C592.19,191.95 603.23,231.96 590,263.01 C584.41,276.13 580.3397,282.3779 569.9497,291.8579 " fill="none" id="OS-to-Fluentd" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="564.04,297.25,571.9718,294.074,567.9277,289.6417,564.04,297.25" style="stroke:#000000;stroke-width:1.0;"/></g><!--link Fluentd to ES--><g id="link_Fluentd_ES"><path d="M578.25,324.53 C616.08,324.53 662.68,324.53 708.21,324.53 " fill="none" id="Fluentd-to-ES" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="714.21,324.53,705.21,320.53,709.21,324.53,705.21,328.53,714.21,324.53" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100" x="596.25" y="318.5998">Envoie les logs</text></g><!--SRC=[bPA_Ri8m48TtFyKrGzKE8BLZ1wIsIX7z0qYMsW4o7Ca9B1mxiXqegdYNhdqENgn774M2eLAz91VVzvtzKox2Yag2IgComg-LgT1X2RajAsl811bscg0kzQqG5UPhN18aO-lXJUNEUd8RbPDFu4i0BqTvGBDa8hcVZc28WRQuIm0z33_QdkEQlTgbXsSv6MVDj_qvFNMsgFC0CWve35Fv7yF45UHE-CdV_5u8lfm9a3pfcf_5t5mzMgrPIRMxRXJjZX051boWvpcfHXzKxWbTlc941XjJkeIHAUWJWx8cqgaKOlP12tXmTilHPT0RmEn5BT0Wa-_ArwYLZqGcsftObSeCxjWOo3dBTaqU2clCuOUy41nkhpSOTEVZg4xgoLajsfUZEfKiJit6gcZL78mGnWRgak3V8UO0mTQ-wveR2ar1aJvymqaQ_URMuvjkMhz_h7u1]--></g></svg></div></section><section class="chapter"><h2 id="l-importance-des-logs-structur-s-json" data-toc="l-importance-des-logs-structur-s-json">L'importance des Logs Structur&eacute;s (JSON)</h2><p id="-s4cx0x_57">Un log standard ressemble souvent &agrave; ceci : <code class="code" id="-s4cx0x_63">2023-10-27 10:30:05.123 INFO [product-service] [http-nio-8081-exec-1] c.f.s.p.ProductController - Product with id 1 found.</code></p><p id="-s4cx0x_58">C'est lisible pour un humain, mais difficile &agrave; analyser pour une machine. Pour la filtrer, il faut utiliser des expressions r&eacute;guli&egrave;res complexes.</p><p id="-s4cx0x_59">La solution est le <span class="control" id="-s4cx0x_64">log structur&eacute;</span>, le plus souvent au format <span class="control" id="-s4cx0x_65">JSON</span>. On configure notre application pour qu'elle produise des logs qui sont d&eacute;j&agrave; des objets JSON :</p><div class="code-block" data-lang="json">
{
  &quot;@timestamp&quot;: &quot;2023-10-27T10:30:05.123+02:00&quot;,
  &quot;level&quot;: &quot;INFO&quot;,
  &quot;service&quot;: &quot;product-service&quot;,
  &quot;thread_name&quot;: &quot;http-nio-8081-exec-1&quot;,
  &quot;logger_name&quot;: &quot;fr.formation.spring.productservice.controller.ProductController&quot;,
  &quot;message&quot;: &quot;Product with id 1 found.&quot;,
  &quot;product_id&quot;: 1,
  &quot;trace_id&quot;: &quot;a4fde8a1-b2c3-4d5e-f6a7-b8c9d0e1f2a3&quot;
}
</div><p id="-s4cx0x_61"><span class="control" id="-s4cx0x_66">Pourquoi c'est mieux ?</span></p><ul class="list _bullet" id="-s4cx0x_62"><li class="list__item" id="-s4cx0x_67"><p id="-s4cx0x_69"><span class="control" id="-s4cx0x_70">Facile &agrave; parser :</span> Elasticsearch adore le JSON. Il va automatiquement cr&eacute;er des &quot;champs&quot; pour <code class="code" id="-s4cx0x_71">level</code>, <code class="code" id="-s4cx0x_72">service</code>, <code class="code" id="-s4cx0x_73">product_id</code>, etc.</p></li><li class="list__item" id="-s4cx0x_68"><p id="-s4cx0x_74"><span class="control" id="-s4cx0x_76">Recherche puissante :</span> Avec Kibana, on peut alors faire des recherches tr&egrave;s simples et puissantes, comme :</p><ul class="list _bullet" id="-s4cx0x_75"><li class="list__item" id="-s4cx0x_77"><p id="-s4cx0x_80"><code class="code" id="-s4cx0x_81">level: &quot;ERROR&quot;</code> (Montre-moi toutes les erreurs)</p></li><li class="list__item" id="-s4cx0x_78"><p id="-s4cx0x_82"><code class="code" id="-s4cx0x_83">service: &quot;order-service&quot;</code> (Montre-moi uniquement les logs de ce service)</p></li><li class="list__item" id="-s4cx0x_79"><p id="-s4cx0x_84"><code class="code" id="-s4cx0x_85">product_id: 123</code> (Montre-moi tous les logs concernant ce produit sp&eacute;cifique)</p></li></ul></li></ul></section><section class="chapter"><h2 id="l-id-de-corr-lation-suivre-une-requ-te-de-bout-en-bout" data-toc="l-id-de-corr-lation-suivre-une-requ-te-de-bout-en-bout">L'ID de Corr&eacute;lation : Suivre une Requ&ecirc;te de bout en bout</h2><p id="-s4cx0x_86">C'est la fonctionnalit&eacute; la plus magique. Comment savoir que le log de l'API Gateway, celui de l'Order Service et celui du Product Service concernent tous la m&ecirc;me requ&ecirc;te de l'utilisateur ?</p><p id="-s4cx0x_87">Gr&acirc;ce &agrave; un <span class="control" id="-s4cx0x_92">ID de trace</span> (ou ID de corr&eacute;lation). Des biblioth&egrave;ques comme <span class="control" id="-s4cx0x_93">Micrometer Tracing</span> (le successeur de Spring Cloud Sleuth) s'en chargent pour nous.</p><ol class="list _decimal" id="-s4cx0x_88" type="1"><li class="list__item" id="-s4cx0x_94"><p id="-s4cx0x_99">Quand une requ&ecirc;te entre pour la premi&egrave;re fois dans notre syst&egrave;me (au niveau de l'API Gateway), Micrometer Tracing lui assigne un ID de trace unique (ex: <code class="code" id="-s4cx0x_100">a4fde8a1...</code>).</p></li><li class="list__item" id="-s4cx0x_95"><p id="-s4cx0x_101">Cet ID est ajout&eacute; &agrave; un contexte de log (le MDC - Mapped Diagnostic Context). Notre logger JSON l'inclura dans chaque ligne de log.</p></li><li class="list__item" id="-s4cx0x_96"><p id="-s4cx0x_102"><span class="control" id="-s4cx0x_103">Plus important :</span> Lorsque la Gateway fait un appel &agrave; l'Order Service, Micrometer Tracing propage automatiquement cet ID de trace dans les en-t&ecirc;tes HTTP de la requ&ecirc;te.</p></li><li class="list__item" id="-s4cx0x_97"><p id="-s4cx0x_104">L'Order Service re&ccedil;oit la requ&ecirc;te, voit l'en-t&ecirc;te, et utilise ce m&ecirc;me ID de trace pour tous ses propres logs.</p></li><li class="list__item" id="-s4cx0x_98"><p id="-s4cx0x_105">Et ainsi de suite...</p></li></ol><p id="-s4cx0x_89">Le r&eacute;sultat ? Tous les logs g&eacute;n&eacute;r&eacute;s par une seule et m&ecirc;me requ&ecirc;te utilisateur, &agrave; travers tous les microservices, partagent le <span class="control" id="-s4cx0x_106">m&ecirc;me <code class="code" id="-s4cx0x_107">trace_id</code></span>.</p><p id="-s4cx0x_90">Dans Kibana, il suffit alors de filtrer sur cet ID (<code class="code" id="-s4cx0x_108">trace_id: &quot;a4fde8a1-b2c3-4d5e-f6a7-b8c9d0e1f2a3&quot;</code>) pour voir l'histoire compl&egrave;te et chronologique de la requ&ecirc;te, de son entr&eacute;e &agrave; sa sortie. Le d&eacute;bogage devient un jeu d'enfant.</p></section><section class="chapter"><h2 id="conclusion-de-la-partie" data-toc="conclusion-de-la-partie">Conclusion de la partie</h2><p id="-s4cx0x_109">Vous comprenez maintenant que les logs ne sont pas juste des messages affich&eacute;s dans une console, mais une source de donn&eacute;es vitale pour l' <span class="control" id="-s4cx0x_114">observabilit&eacute;</span> de votre syst&egrave;me. Vous avez vu que dans un monde distribu&eacute;, la <span class="control" id="-s4cx0x_115">centralisation</span> est obligatoire.</p><p id="-s4cx0x_110">Vous avez d&eacute;couvert la stack <span class="control" id="-s4cx0x_116">EFK (Elasticsearch, Fluentd, Kibana)</span> et le r&ocirc;le de chacun de ses composants. Vous avez surtout compris deux concepts fondamentaux qui d&eacute;cuplent la puissance de la centralisation :</p><ol class="list _decimal" id="-s4cx0x_111" type="1"><li class="list__item" id="-s4cx0x_117"><p id="-s4cx0x_119">Le <span class="control" id="-s4cx0x_120">log structur&eacute; (JSON)</span>, qui transforme vos logs en donn&eacute;es interrogeables.</p></li><li class="list__item" id="-s4cx0x_118"><p id="-s4cx0x_121">L' <span class="control" id="-s4cx0x_122">ID de trace</span>, qui vous permet de suivre une requ&ecirc;te &agrave; travers le labyrinthe de vos microservices.</p></li></ol><p id="-s4cx0x_112">Dans le TP qui suit, nous allons ajouter la stack EFK &agrave; notre <code class="code" id="-s4cx0x_123">docker-compose.yml</code>, configurer nos services pour qu'ils parlent en JSON, et utiliser Kibana pour explorer le flux de logs de notre application.</p></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><ol class="list _decimal" id="-s4cx0x_124" type="1"><li class="list__item" id="-s4cx0x_125"><p id="-s4cx0x_130"><span class="control" id="-s4cx0x_131">(Question ouverte)</span> Expliquez avec vos propres mots le principal probl&egrave;me que la centralisation des logs cherche &agrave; r&eacute;soudre.</p></li><li class="list__item" id="-s4cx0x_126"><p id="-s4cx0x_132"><span class="control" id="-s4cx0x_134">(QCM)</span> Dans la stack EFK, quel composant est responsable de la collecte et de l'acheminement des logs ?</p><ul class="list _bullet" id="-s4cx0x_133"><li class="list__item" id="-s4cx0x_135"><p id="-s4cx0x_139">A) Elasticsearch</p></li><li class="list__item" id="-s4cx0x_136"><p id="-s4cx0x_140">B) Fluentd</p></li><li class="list__item" id="-s4cx0x_137"><p id="-s4cx0x_141">C) Kibana</p></li><li class="list__item" id="-s4cx0x_138"><p id="-s4cx0x_142">D) Logback</p></li></ul></li><li class="list__item" id="-s4cx0x_127"><p id="-s4cx0x_143"><span class="control" id="-s4cx0x_145">(QCM)</span> Quel est le principal avantage de produire des logs au format JSON ?</p><ul class="list _bullet" id="-s4cx0x_144"><li class="list__item" id="-s4cx0x_146"><p id="-s4cx0x_150">A) Ils sont plus compacts que le texte brut.</p></li><li class="list__item" id="-s4cx0x_147"><p id="-s4cx0x_151">B) Ils sont plus faciles &agrave; lire pour un humain.</p></li><li class="list__item" id="-s4cx0x_148"><p id="-s4cx0x_152">C) Ils sont nativement structur&eacute;s, ce qui facilite leur indexation et leur interrogation par des outils.</p></li><li class="list__item" id="-s4cx0x_149"><p id="-s4cx0x_153">D) Ils sont chiffr&eacute;s par d&eacute;faut.</p></li></ul></li><li class="list__item" id="-s4cx0x_128"><p id="-s4cx0x_154"><span class="control" id="-s4cx0x_155">(Question ouverte)</span> Qu'est-ce qu'un ID de trace (ou de corr&eacute;lation) et comment est-il propag&eacute; entre les microservices ?</p></li><li class="list__item" id="-s4cx0x_129"><p id="-s4cx0x_156"><span class="control" id="-s4cx0x_158">(QCM)</span> Pour retrouver tous les logs li&eacute;s &agrave; une seule requ&ecirc;te utilisateur qui a travers&eacute; 3 microservices, sur quel champ est-il plus efficace de filtrer dans Kibana ?</p><ul class="list _bullet" id="-s4cx0x_157"><li class="list__item" id="-s4cx0x_159"><p id="-s4cx0x_163">A) <code class="code" id="-s4cx0x_164">level: &quot;INFO&quot;</code></p></li><li class="list__item" id="-s4cx0x_160"><p id="-s4cx0x_165">B) <code class="code" id="-s4cx0x_166">service: &quot;api-gateway&quot;</code></p></li><li class="list__item" id="-s4cx0x_161"><p id="-s4cx0x_167">C) <code class="code" id="-s4cx0x_168">timestamp</code></p></li><li class="list__item" id="-s4cx0x_162"><p id="-s4cx0x_169">D) <code class="code" id="-s4cx0x_170">trace_id</code></p></li></ul></li></ol></section><div class="last-modified">17 juillet 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="009-01-tp-9.html" class="navigation-links__prev">TP 9 : &quot;Montrez patte blanche&quot; - S&eacute;curisation de l'API avec Keycloak et Spring Security</a><a href="010-01-tp-10.html" class="navigation-links__next">TP 10 : Mise en Place de la Centralisation des Logs avec EFK</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>